<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Ephen‘s Blog</title>
  
  <subtitle>奇葩一朵， IT 废材</subtitle>
  <link href="https://ephen.me/atom.xml" rel="self"/>
  
  <link href="https://ephen.me/"/>
  <updated>2023-05-15T08:12:27.819Z</updated>
  <id>https://ephen.me/</id>
  
  <author>
    <name>Ephen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>不用破解注册，也许可以永久试用订阅式的 Axure RP 10 软件</title>
    <link href="https://ephen.me/2023/Reg-Axure10/"/>
    <id>https://ephen.me/2023/Reg-Axure10/</id>
    <published>2023-05-12T16:00:00.000Z</published>
    <updated>2023-05-15T08:12:27.819Z</updated>
    
    <content type="html"><![CDATA[<p>众所周知，Axure 9 升级到 Axure 10 后，就从原本的永久授权变更为订阅授权。同时 Axure 10 的订阅注册激活码与 Axure Cloud 的用户账号强绑定，激活时将根据登录账号在线跳转到官方网站实时获取注册状态。</p><p>一直以来，我还挺喜欢尝试新鲜事物的，尤其是各种软件、网站、科技产品等。Axure 作为互联网产品经理的必备软件，在 Axure 10 正式版诞生后，它默认提供一个月的试用期，于是我就早早的参与到试用大军中。</p><p>别说还挺好用的，尤其是动态面板多状态一起编辑，以及一键将表单转换成中继器并将中继器表格直接浮于内容区，真的有惊艳到我。（虽然工作中这俩功能其实并不常用hhh</p><p>尽管被惊艳到，但由于我已经习惯了 Axure 9 ，试用期一过就没有再去尝试了。并且由于高版本文件无法用低版本打开，所以也没敢将 Axure 10 作为正式的生产力工具。</p><p>前段时间心情不错，突然又想折腾一番～</p><span id="more"></span><h2 id="背景原理"><a href="#背景原理" class="headerlink" title="背景原理"></a>背景原理</h2><p>既然可以免费试用一个月，那么验证时一定跟你打开软件的时间有关系。</p><p>Axure 这款软件性质是本地软件，正常来讲除了原型发布时其他时间均无需联网。</p><p>尝试了下：</p><blockquote><p>将电脑断网后通过离线修改 PC 本地的系统时间到可试用时间，再打开 Axure RP 10 确实可以继续试用。而且只要当前运行的软件不退出（窗口不关闭），即使恢复联网电脑系统时间被同步到正确到时间，依然还可以正常使用。</p></blockquote><p>可是，咱总不能为了使用这款软件每次去断网修改系统时间后再联网吧？那可多麻烦。</p><p>就没有什么办法可以让这个软件启动的时候就自动完成这些操作吗？</p><p>答案当然是“有”，而且可能比咱想象的更好用。</p><h2 id="Windows-环境"><a href="#Windows-环境" class="headerlink" title="Windows 环境"></a>Windows 环境</h2><p>要说我能找到这样的工具，得益于软件测试的出身。当遇到有关时间的测试时，总会去获得一些奇怪的知识。</p><p>Windows 兼容性高，逆向工程较成熟，反编译的成本相对来说比较低，所以能为软件修改启动时间的工具还挺多的。</p><p>下面就以 Axure 10 的使用为例，挑几个比较知名的工具介绍下。</p><h3 id="RunAsDate"><a href="#RunAsDate" class="headerlink" title="RunAsDate"></a>RunAsDate</h3><p>官方网站：<a href="https://www.nirsoft.net/utils/run_as_date.html">https://www.nirsoft.net/utils/run_as_date.html</a></p><p>RunAsDate 是一个绿色便携的软件，不用安装也不写注册表，就地执行即可。</p><p>为了方便永久试用目标软件，它可以在指定目标软件后创建新的目标软件快捷方式。此后点击该快捷方式即可运行目标软件，并且目标软件的系统启动时间就是你设置的时间。以下是我本地的软件配置：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/Axure-RunAsDate-1.png" alt="RunAsDate"></p><p>完成快捷方式创建后启动 Axure RP 10 的效果，右上角提示还有 11 天过期（我是 2022 年 3 月份申请试用的）：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/Axure-RunAsDate-2.png" alt="RunAsDate"></p><p>PS：创建快捷方式后会在同目录生成 RunAsDate 的启动参数配置文件 <code>RunAsDate.cfg</code> ，另外也可以在同目录通过写一个名为 <code>RunAsDate_lng.ini</code> 的语言配置文件达到为 RunAsDate 汉化的目的（官方网站上有提供汉化配置下载）。因此建议将 RunAsDate 工具及其配置放到一个独立的目录，然后可将该目录和目标软件目录放到一起。</p><h3 id="CrackLock"><a href="#CrackLock" class="headerlink" title="CrackLock"></a>CrackLock</h3><p>官方网站：<a href="https://william.famille-blum.org/software/cracklock/">https://william.famille-blum.org/software/cracklock/</a></p><p>CrackLock 多年前用来做过测试，原理是一样的，也是改程序运行时的虚拟时间来实现。</p><p>因为这个软件需要安装，所以我个人更倾向使用 RunAsDate 。不过它有个优点是可以直接修改替换掉可执行程序（当软件禁止注入时就可能是缺点了），我没有在 Axure 10 上试用，感兴趣的童鞋可以试试看。</p><h2 id="MAC-环境"><a href="#MAC-环境" class="headerlink" title="MAC 环境"></a>MAC 环境</h2><h3 id="libfaketime"><a href="#libfaketime" class="headerlink" title="libfaketime"></a>libfaketime</h3><p>这是一个开源的程序库，其 GitHub 地址：<a href="https://github.com/wolfcw/libfaketime">https://github.com/wolfcw/libfaketime</a></p><p>这个库在 Linux 和 MAC 上都可以用，通常用来测试 Linux 上开发的软件。虽然 MAC 上可能会惯常用 UI 应用程序（就像 Axure 一样），其实也是可以找到对应的可执行程序来使用的。</p><p>话不多说，先安装起来。</p><p>打开终端，在本地创建一个目录后，<code>git clone https://github.com/wolfcw/libfaketime.git</code> 下载源码，然后进入目录执行 <code>sudo make install</code> 输入本机登录密码即可安装成功。</p><p>安装成功后，可通过 <code>faketime</code> 命令测试软件是否能达到效果。例如在 <code>date</code> 命令前置 <code>faketime</code> 以输出时间：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ » faketime -f &#x27;2022-04-01 00:00:00&#x27; date                            </span><br><span class="line">2022年 4月 1日 星期五 00时00分00秒 CST</span><br></pre></td></tr></table></figure><p>然后同样的道理可以用到应用程序上，将上面的 <code>date</code> 命令替换为 App 的全路径可执行程序即可。例如可以试试将 Axure RP 10 的可执行路径 <code>/Applications/Axure\ RP\ 10.app/Contents/MacOS/Axure\ RP\ 10</code> 放到 <code>faketime</code> 后执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~ » faketime -f &#x27;@2022-04-01 00:00:00&#x27; /Applications/Axure\ RP\ 10.app/Contents/MacOS/Axure\ RP\ 10 </span><br><span class="line">Environment version 6.0.0</span><br><span class="line">Framework description .NET 6.0.0-rtm.21522.10</span><br></pre></td></tr></table></figure><p>可以看到已正常启动软件，并且右上角也是提示还有 11 天过期：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/AxureRP10-184716.png" alt="Axure RP 10"></p><p>可如果每次都要这样启动，是不是未免也太麻烦了点？</p><p>其实也不用。</p><p>我们进入到应用程序列表，双指点击 <code>Axure RP 10</code> 后单指点击“显示包内容”：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/Axure-190101.png" alt="Axure RP 10"></p><p>打开后会看到当前目录下有一个名为 <code>info.plist</code> 的文件：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/Axure-191824.png" alt="Axure RP 10"></p><p>然后编辑这个文件，在 <code>&lt;dict&gt;</code> 内加入如下代码后保存：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">key</span>&gt;</span>LSEnvironment<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>DYLD_FORCE_FLAT_NAMESPACE<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>1<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>DYLD_INSERT_LIBRARIES<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>/usr/local/lib/faketime/libfaketime.1.dylib<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>FAKETIME<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>@2022-04-01 00:00:00<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">key</span>&gt;</span>FAKETIME_STOP_AFTER_SECONDS<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">string</span>&gt;</span>10<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://iephen.pek3b.qingstor.com/b_image/Axure-192011.png" alt="Axure RP 10"></p><p>编辑完后重启电脑，或者打开终端执行命令： <code>/System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -v -f /Applications/Axure\ RP\ 10.app</code></p><p>设置完成后，打开启动台点击 Axure RP 10 的图标即可正常使用咯。</p><p>不过，此方法可能会在软件更新或升级后因重置了 <code>info.plist</code> 而失效，需要再次做上述操作后才可使用。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>以上方法仅供个人测试，商业使用还请寻找官方渠道获得授权。</p><p>由于各软件的验证机制的原因，不保证通用，也无法保证以上方法永久有效，还请低调试用。</p><p>PS：若试用不成功请自行解决或购买授权，本人不会提供任何技术解答。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;众所周知，Axure 9 升级到 Axure 10 后，就从原本的永久授权变更为订阅授权。同时 Axure 10 的订阅注册激活码与 Axure Cloud 的用户账号强绑定，激活时将根据登录账号在线跳转到官方网站实时获取注册状态。&lt;/p&gt;
&lt;p&gt;一直以来，我还挺喜欢尝试新鲜事物的，尤其是各种软件、网站、科技产品等。Axure 作为互联网产品经理的必备软件，在 Axure 10 正式版诞生后，它默认提供一个月的试用期，于是我就早早的参与到试用大军中。&lt;/p&gt;
&lt;p&gt;别说还挺好用的，尤其是动态面板多状态一起编辑，以及一键将表单转换成中继器并将中继器表格直接浮于内容区，真的有惊艳到我。（虽然工作中这俩功能其实并不常用hhh&lt;/p&gt;
&lt;p&gt;尽管被惊艳到，但由于我已经习惯了 Axure 9 ，试用期一过就没有再去尝试了。并且由于高版本文件无法用低版本打开，所以也没敢将 Axure 10 作为正式的生产力工具。&lt;/p&gt;
&lt;p&gt;前段时间心情不错，突然又想折腾一番～&lt;/p&gt;</summary>
    
    
    
    <category term="工作笔记" scheme="https://ephen.me/categories/MyWork/"/>
    
    <category term="工具介绍" scheme="https://ephen.me/categories/tools/"/>
    
    
    <category term="Axure" scheme="https://ephen.me/tags/Axure/"/>
    
    <category term="PM" scheme="https://ephen.me/tags/PM/"/>
    
    <category term="RunAsDate" scheme="https://ephen.me/tags/RunAsDate/"/>
    
    <category term="libfaketime" scheme="https://ephen.me/tags/libfaketime/"/>
    
  </entry>
  
  <entry>
    <title>NodeJS 和 Hexo 版本升级记，继续填坑博客配置</title>
    <link href="https://ephen.me/2022/blog-updates-plus/"/>
    <id>https://ephen.me/2022/blog-updates-plus/</id>
    <published>2022-02-24T16:00:00.000Z</published>
    <updated>2023-05-25T05:58:17.969Z</updated>
    
    <content type="html"><![CDATA[<p>继填坑《<a href="/2022/blog-sequela/">博客更新后遗症</a>》后，心里总是隐隐有些不安。毕竟作为一个喜欢探索的人，根本无法容忍版本降级。</p><p>于是决定再重新把 NodeJS 装回最新版本看看到底会发生什么，以及能不能不通过降版的方式解决。</p><p>先仔细检查下当前的版本配置。惊奇的发现 hexo 版本并没有升级！（<del>果然之前的一顿操作太秀逗了</del>）</p><blockquote><p>之前的<code>npm install -g hexo-cli</code> 命令应该是只升级了 <code>hexo-cli</code> ，我本地的 hexo 版本才 <code>V3.9.0</code> 。</p></blockquote><p>好吧，那就一次性都升级了再说。</p><span id="more"></span><h2 id="升级-hexo-及全部插件"><a href="#升级-hexo-及全部插件" class="headerlink" title="升级 hexo 及全部插件"></a>升级 hexo 及全部插件</h2><p>先安装 <code>npm-check</code> 和 <code>npm-upgrade</code> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm-check npm-upgrade</span><br></pre></td></tr></table></figure><p>安装完后，执行 <code>npm-check</code> 即可检查本地各插件版本情况。</p><p>执行 <code>npm-upgrade</code> 可根据当前版本和最新版本比较，让用户确认和选择是否升级。<br>若用户确认升级，则会自动把 <code>package-lock.json</code> 和 <code>package.json</code> 文件内容进行更新后保存，然后执行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update -g --save </span><br></pre></td></tr></table></figure><p>上述命令执行完毕，则所有通过 <code>npm-upgrade</code> 确认的插件全部都升级到最新（包括 Hexo）。</p><p>升级完后通过 <code>hexo version</code> 验证 Hexo 版本，已经更新到最新的 <code>6.0.0</code> 啦！</p><h2 id="升级-NodeJS-和-npm"><a href="#升级-NodeJS-和-npm" class="headerlink" title="升级 NodeJS 和 npm"></a>升级 NodeJS 和 npm</h2><p>再使用 <code>npm-check</code> 检查，发现一些 Hexo 专属插件得不到验证。那我无法确认肯定是不甘心的嘛！于是求助朋友 <a href="https://blog.skk.moe/">@Sukka</a> 后，他告诉我在 Hexo 上建议使用 <code>npm outdated</code> 命令来检查。</p><p>执行后发现没反应，苏卡卡提示我要 npm v7 版本以上才可以使用，这才想起我 NodeJS 还未升级。于是上官网下载最新支持 LTS 的版本 <code>v16.14.0</code> 重新安装。然后执行以下命令升级 npm ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i npm@latest -g</span><br></pre></td></tr></table></figure><p>最后执行 <code>npm outdated</code> 命令检查 Hexo 插件版本情况，发现还有两个插件需要更新：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220225154316.jpg" alt="plugins_outdated"></p><p>去 Hexo 官网搜索这两个插件的作用，我发现我根本就没有用到 rsync 同步，于是将 <code>hexo-deployer-rsync</code> 插件卸载掉了。</p><h2 id="修复并解决升级带来的问题"><a href="#修复并解决升级带来的问题" class="headerlink" title="修复并解决升级带来的问题"></a>修复并解决升级带来的问题</h2><h3 id="百度站点地图插件无法升级"><a href="#百度站点地图插件无法升级" class="headerlink" title="百度站点地图插件无法升级"></a>百度站点地图插件无法升级</h3><p>接上一章节，由于想到国内还是以百度为主，于是升级插件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update hexo-generator-baidu-sitemap</span><br></pre></td></tr></table></figure><p>发现升级不成功，根据 Log 提示执行 <code>npm audit fix</code> 无法解决。再执行 <code>npm audit fix --force</code> 发现，把我的 Hexo 版本又降回了 <code>v3.9.0</code> ！于是又重来 <code>npm-upgrade</code> ，最终反反复复升级、降级了好几次，暴脾气灰姑娘直接就原地爆炸了。</p><p>于是访问百度站长平台去研究下站点收录的方式，以确定该插件在我博客上存在的价值。强行通过以下两点自证该插件价值为 0 后，<strong>将之删除</strong>：</p><ol><li>我博客上存在 <code>hexo-generator-sitemap</code> 插件，生成的站点地图（ <code>sitemap.xml</code> ）有被百度抓取收录，并且收录数量比百度专属插件生成的 <code>baidusitemap.xml</code> 还多几个（但其实对比 Google 后发现，百度对站点地图的支持并不友好，相比之下收录少得可怜）。</li><li>我每次写完博文提交后，都会通过脚本（详见《<a href="/2016/hello-hexo/#RSS-%E3%80%81%E7%AB%99%E7%82%B9%E5%9C%B0%E5%9B%BE%E5%8F%8A%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96">全新出发，正式启用 Hexo ！</a>》文中所述）调 API 手动更新收录，这个收录是最全最实时的，比 SiteMap 好用。</li></ol><p>删除插件及相关配置后，看着 <code>npm outdated</code> 命令执行后的干净对话框，心想终于清净了。赶紧看看本地博客运行的情况~</p><h3 id="external-link-配置报错"><a href="#external-link-配置报错" class="headerlink" title="external_link 配置报错"></a>external_link 配置报错</h3><p>执行 <code>hexo clean</code> 后，在执行 <code>hexo g</code> 生成文件时，Hexo 就给了我第一个下马威：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INFO  Validating config</span><br><span class="line">WARN  Deprecated config detected: &quot;external_link&quot; with a Boolean value is deprecated. See https://hexo.io/docs/configuration for more details.</span><br></pre></td></tr></table></figure><p>尽管只是个 WARN 报错，但我自然是不甘心的。想来我从 <code>v3.9.0</code> 一步跨越到 <code>v6.0.0</code> ，仅大版本就跳了三级。</p><p>于是去找下 Hexo 官方有没有 Release Notes，一个个的看。终于在 <code>2020-7-29</code> 发布的 <a href="https://hexo.io/news/2020/07/29/hexo-5-released/">Hexo 5.0.0 Released</a> 中找到了关于 <code>external_link</code> 配置的大变化。</p><p>同时阅读错误信息中提示的官方文档后，将 Hexo 根目录下的配置文件 <code>_config.yml</code> 中的 <code>external_link: true</code> 修改成如下配置：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">external_link:</span> </span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># Apply to the whole site</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>问题解决。再次运行没有出现报错~</p><h3 id="文章路径发生变化"><a href="#文章路径发生变化" class="headerlink" title="文章路径发生变化"></a>文章路径发生变化</h3><p>执行 <code>hexo s</code> 查看本地站点，点到文章《<a href="/2022/blog-sequela">博客更新后遗症</a>》阅读时，发现其中引用的《<a href="/2016/hello-hexo/">全新出发，正式启用 Hexo ！</a>》链接点击报错 <code>404</code> 。</p><p>仔细一看，我原本每篇博文都是放到年份文件夹中，而新的链接都直接用了我博文中标记的 <code>permalink</code> ，因此导致路径变化。</p><p>于是尝试修改文章中的 <code>permalink</code> 无果（加 <code>/:year/</code> 参数无法被识别到），又去求助于苏卡卡同学。苏卡卡同学很疑惑，说 Hexo 的老版本里面并没有在博文中使用 <code>permalink</code> 标签，让我直接去改 <code>_config.yml</code> 文件。</p><p>我查看了 <code>_config.yml</code> 文件后，发现其中配置并没有问题。既然如此，我删掉其中一篇博文的 <code>permalink</code> 标签后测试，发现年份是回来了，但博文路径变成了中文。这下明白了，原来 <code>_config.yml</code> 文件中 <code>permalink</code> 的 <code>:title</code> 变量取的是我的 Markdown 源文件的文件名。</p><p>于是修改所有的博文，删掉每篇博文中的 <code>permalink</code> 标签，然后将 <code>.md</code> 源文件名字改为对应被删除的 <code>permalink</code> 值。</p><p>如下图所示：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220223113316.jpg" alt="修改博文源文件 Permalink "></p><p>至于为什么我那么老的 Hexo 版本就在博文中有 <code>permalink</code> ？我仔细回想了下，应该是当年从 WordPress 迁移博文时，用的那个 <code>hexo-migrator-wordpress</code> 插件的杰作。当时觉得这个标记挺好用的，所以就在后来的每篇博文中沿用了。</p><h3 id="主题调用的副标题和作者信息丢失"><a href="#主题调用的副标题和作者信息丢失" class="headerlink" title="主题调用的副标题和作者信息丢失"></a>主题调用的副标题和作者信息丢失</h3><p>想来上方的链接都能出错，再也不敢掉以轻心。于是我将我线上正在运行的站点和本地生成的站点同时在浏览器打开并排仔细对比，映入眼帘就发现左边栏的差异：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220223113045.jpg" alt="Subtile&amp;Author Lost"></p><p>想起我之前在《<a href="/2019/blog-update/">又来折腾博客了</a>》一文中提到的设置版权信息也有用到作者名字，遂点开任意一篇博文滚到页面底部看到“文章作者”后边也是空的。</p><p>查看本地代码中引用的是 <code>theme.author</code> ，但是在主题的 <code>_config.yml</code> 中并没有搜到 <code>author</code> 配置。查找我当前的文字内容，发现其来源于 Hexo 的 <code>_config.yml</code> 文件中的站点配置：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">Ephen‘s</span> <span class="string">Blog</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">奇葩一朵，</span> <span class="string">IT</span> <span class="string">废材</span></span><br><span class="line"><span class="attr">description:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Ephen</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-Hans</span></span><br><span class="line"><span class="attr">timezone:</span></span><br></pre></td></tr></table></figure><p>于是将 <code>subtitle</code> 和 <code>author</code> 复制到主题的配置文件中，测试通过。</p><h3 id="翻页转义字符显示异常"><a href="#翻页转义字符显示异常" class="headerlink" title="翻页转义字符显示异常"></a>翻页转义字符显示异常</h3><p>继续<del>“欣赏”</del>对比网站，发现页面底部文章列表下方的 Prev 和 Next 两个按钮显示出问题了，字符 <code>«</code> 和 <code>»</code> 没有正常显示，变成了 <code>&amp;laquo;</code> 和 <code>&amp;raquo;</code> 。</p><p>求助谷姐，找到了网友的解决方案（参考链接：<a href="https://www.chenb.top/2018/11/01/blog-way/%EF%BC%89%E3%80%82">https://www.chenb.top/2018/11/01/blog-way/）。</a></p><p>修改文件 <code>archive.ejs</code> ，找到此处源码，增加一行 <code>escape: false,</code> 来解决。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;% if (page.total &gt; 1)&#123; %&gt;</span><br><span class="line">  &lt;nav id=&quot;page-nav&quot;&gt;</span><br><span class="line">    &lt;%- paginator(&#123;</span><br><span class="line">      escape: false,</span><br><span class="line">      prev_text: &#x27;&amp;laquo; Prev&#x27;,</span><br><span class="line">      next_text: &#x27;Next &amp;raquo;&#x27;</span><br><span class="line">    &#125;) %&gt;</span><br><span class="line">  &lt;/nav&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><h3 id="Warning-Accessing-non-existent-property…"><a href="#Warning-Accessing-non-existent-property…" class="headerlink" title="Warning: Accessing non-existent property…"></a>Warning: Accessing non-existent property…</h3><p>站点总算展示<del>完美</del>了，回过头来看到在运行 <code>hexo s</code> 时还有一些 Warning 报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.</span><br><span class="line">(node:1656) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(Use `node --trace-warnings ...` to show where the warning was created)</span><br><span class="line">(node:1656) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:1656) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br><span class="line">(node:1656) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">(node:1656) Warning: Accessing non-existent property &#x27;column&#x27; of module exports inside circular dependency</span><br><span class="line">(node:1656) Warning: Accessing non-existent property &#x27;filename&#x27; of module exports inside circular dependency</span><br></pre></td></tr></table></figure><p>虽然是 Warning 不影响，但看着就是难受啊。经过度娘和谷姐的双重帮助下，大家的解决方案要么是降级 Nodejs 要么就是升级 Hexo 、升级插件 <code>hexo-renderer-stylus</code> 。</p><p>降级我知道肯定没毛病，但我不就白折腾了吗？而我的 Hexo 版本和 <code>hexo-renderer-stylus</code> 插件版本已经是最新了，各种暴力重装也没法解决。也试过网友们说的加 <code>&quot;stylus&quot;: &quot;^0.54.8&quot;</code> 、<code>exports.lineno = null;</code> 等操作，依然还存在这个问题。</p><p>只好自己上阵弄了。运行 <code>npx cross-env NODE_OPTIONS=&quot;--trace-warnings&quot; hexo s</code> 拿到报错详情：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ npx cross-env NODE_OPTIONS=&quot;--trace-warnings&quot; hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.</span><br><span class="line">(node:11088) Warning: Accessing non-existent property &#x27;lineno&#x27; of module exports inside circular dependency</span><br><span class="line">    at emitCircularRequireWarning (node:internal/modules/cjs/loader:707:11)</span><br><span class="line">    at Object.get (node:internal/modules/cjs/loader:721:5)</span><br><span class="line">    at Boolean.Node [as constructor] (D:\Hexo\ephen.github.io\node_modules\nib\node_modules\stylus\lib\nodes\node.js:42:23)</span><br><span class="line">    at new Boolean (D:\Hexo\ephen.github.io\node_modules\nib\node_modules\stylus\lib\nodes\boolean.js:23:8)</span><br><span class="line">    at Object.&lt;anonymous&gt; (D:\Hexo\ephen.github.io\node_modules\nib\node_modules\stylus\lib\nodes\index.js:57:16)</span><br><span class="line">    at Module._compile (node:internal/modules/cjs/loader:1103:14)</span><br><span class="line">    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1155:10)</span><br><span class="line">    at Module.load (node:internal/modules/cjs/loader:981:32)</span><br><span class="line">    at Function.Module._load (node:internal/modules/cjs/loader:822:12)</span><br><span class="line">    at Module.require (node:internal/modules/cjs/loader:1005:19)</span><br><span class="line">    at require (node:internal/modules/cjs/helpers:102:18)</span><br><span class="line">    at Object.&lt;anonymous&gt; (D:\Hexo\ephen.github.io\node_modules\nib\node_modules\stylus\lib\lexer.js:13:13)</span><br><span class="line">    at Module._compile (node:internal/modules/cjs/loader:1103:14)</span><br><span class="line">    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1155:10)</span><br><span class="line">    at Module.load (node:internal/modules/cjs/loader:981:32)</span><br><span class="line">    at Function.Module._load (node:internal/modules/cjs/loader:822:12)</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>找到错误信息中提到的 4 个文件的具体错误位置一个个的查看与报错相关联的内容，最终删除了 <code>.\node_modules\nib\node_modules\stylus\lib\nodes\node.js</code> 文件中的一段代码后解决。</p><p>修改前这段代码为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var Node = module.exports = function Node()&#123;</span><br><span class="line">  this.lineno = nodes.lineno || 1;</span><br><span class="line">  this.column = nodes.column || 1;</span><br><span class="line">  this.filename = nodes.filename;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>修改后：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var Node = module.exports = function Node()&#123;&#125;;</span><br></pre></td></tr></table></figure><p>我也不知道是啥意思，反正观摩了半天没发现出什么问题，等出了问题再来回溯吧。</p><h2 id="后记：一点小插曲"><a href="#后记：一点小插曲" class="headerlink" title="后记：一点小插曲"></a>后记：一点小插曲</h2><p>其实这次还解决了一些 Web F12 发现的报错问题，都比较小也不太典型，因此就此略过。</p><p>另外，在查阅 Hexo 官方各大版本升级公告时，发现还有主题配置方式的大改变，所幸我的站点尚未被影响到。查问题时有段时间以为是我主题配置的问题，准备迁移到最新的配置方式上去。但是感觉搞起来特别麻烦，准备弃坑 Hexo 了，最后还是沉下心来把问题一个个的解决。</p><p>现在站点运行还算稳，就先这样吧。等以后什么时候有空了，再来看看主题的事。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;继填坑《&lt;a href=&quot;/2022/blog-sequela/&quot;&gt;博客更新后遗症&lt;/a&gt;》后，心里总是隐隐有些不安。毕竟作为一个喜欢探索的人，根本无法容忍版本降级。&lt;/p&gt;
&lt;p&gt;于是决定再重新把 NodeJS 装回最新版本看看到底会发生什么，以及能不能不通过降版的方式解决。&lt;/p&gt;
&lt;p&gt;先仔细检查下当前的版本配置。惊奇的发现 hexo 版本并没有升级！（&lt;del&gt;果然之前的一顿操作太秀逗了&lt;/del&gt;）&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;之前的&lt;code&gt;npm install -g hexo-cli&lt;/code&gt; 命令应该是只升级了 &lt;code&gt;hexo-cli&lt;/code&gt; ，我本地的 hexo 版本才 &lt;code&gt;V3.9.0&lt;/code&gt; 。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;好吧，那就一次性都升级了再说。&lt;/p&gt;</summary>
    
    
    
    <category term="博客折腾" scheme="https://ephen.me/categories/MyBlog/"/>
    
    
    <category term="hexo" scheme="https://ephen.me/tags/hexo/"/>
    
    <category term="node" scheme="https://ephen.me/tags/node/"/>
    
    <category term="npm" scheme="https://ephen.me/tags/npm/"/>
    
    <category term="stylus" scheme="https://ephen.me/tags/stylus/"/>
    
  </entry>
  
  <entry>
    <title>博客 Hexo 工作区同步至 Mac ，多个电脑可同时写博客啦～</title>
    <link href="https://ephen.me/2022/hexo-syn/"/>
    <id>https://ephen.me/2022/hexo-syn/</id>
    <published>2022-02-19T16:00:00.000Z</published>
    <updated>2023-05-25T06:01:30.880Z</updated>
    
    <content type="html"><![CDATA[<p>一个月前，公司资产部在一年一度处理离职员工回收的资产时，我获得了一台 MacBook Air 。</p><p>由于过去从未用过 Mac ，在摸清了大致的用法后，突然想再折腾下博客。</p><p>之前我没有个人电脑，每次更换工作电脑（均为 Windows 操作系统）时，直接用 U 盘复制本地 Hexo 工作目录到新电脑上，安装相关依赖后使用。</p><p>这次准备把新到的 MacBook Air 作为我的个人电脑使用，然后让个人电脑和工作电脑都可以用来更新博客，所以需要考虑 Hexo 源文件多端同步了。</p><span id="more"></span><h2 id="为什么要同步-Hexo-源文件"><a href="#为什么要同步-Hexo-源文件" class="headerlink" title="为什么要同步 Hexo 源文件"></a>为什么要同步 Hexo 源文件</h2><p>用 Hexo 搭建博客的同学应该比较清楚： 当我们用 markdown 写好博文后，需要先执行 <code>hexo g</code> 命令生成 html 文件，再通过 <code>hexo d</code> 命令将生成的 html 文件发布到 Github Page ，这样 GitHub Page 即可直接当个人网站使用了。</p><p>所以 Github Page 上只有 html 格式静态网页，而我们通过 markdown 写的源文件，以及 hexo 主题文件和插件等信息都不会上传。</p><p><code>hexo g</code> 的动作相当于网页编译行为，而当我们需要在其他电脑上也可以同步写文章时，就需要把 hexo 工作区进行同步。</p><h2 id="使用-GitHub-存储-hexo-源文件"><a href="#使用-GitHub-存储-hexo-源文件" class="headerlink" title="使用 GitHub 存储 hexo 源文件"></a>使用 GitHub 存储 hexo 源文件</h2><p>Github 是个很好的代码协同平台，我的博客本身也是放 GitHub Page ，因此我选择在 GitHub Page 项目源代码上新建一个分支来存放 hexo 源文件作为我的线上工作区。</p><p>登录 GitHub 后进入到我博客所在项目查看源代码，基于 <code>master</code> 新建一个名为 <code>suorce</code> 的分支，并将该分支设置为默认分支。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220220144314.png" alt="GitHub 分支管理"></p><p>回到工作电脑上，新建一个工作区目录，执行 <code>git clone 项目地址 .</code> 将 github 上的代码下载下来。由于默认分支现在是 <code>source</code> ，因此本地工作区也默认为 <code>source</code> 分支。</p><p>由于远程分支是基于原分支复制的，因此内容和 master 一样，都是博客 html 文件。我除了保留此目录下隐藏的 <code>.git</code> 文件夹外，删除其他所有文件，再把之前工作目录下所有文件（含隐藏文件）复制过来。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220220160320.png" alt="文件夹对比"></p><p>测试下新的工作目录是否能正确运行 hexo 及 Node.js 相关指令，并本地预览确认无误。</p><p>然后创建 <code>.gitignore</code> 文件，内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">db.json</span><br><span class="line">*.log</span><br><span class="line">node_modules/</span><br><span class="line">public/</span><br><span class="line">.deploy*/</span><br></pre></td></tr></table></figure><blockquote><p><code>.gitignore</code> 文件用于指明哪些文件不用上传或同步。</p></blockquote><ol><li><code>node_modules/</code> 是 hexo 用到的 node.js 插件，这个可以在 node.js 环境中直接通过 <code>npm install</code> 命令直接安装，而所有用到的插件信息在目录下的 <code>package.json</code> 文件中有记录；</li><li><code>public/</code> 是在执行 <code>hexo g</code> 命令后生成的全部网页文件及目录，这部分内容不稳定，当执行 <code>hexo c</code> 命令后，该目录就会被删除；</li><li><code>.deploy_git/</code> 是在执行 <code>hexo d</code> 时从 <code>public/</code> 目录复制过来的，用于发布至 GitHub Page ，这部分内容最终会同步至原本的 <code>master</code> 分支。</li></ol><p>做完这些操作后，依次执行以下命令来完成提交：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &quot;XXXX&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure><p>此时再登录到 GitHub 网站上，即可看到最新的源代码保持与本地最新工作目录一致了（已忽略的文件夹除外）。</p><h2 id="Mac-环境安装及配置"><a href="#Mac-环境安装及配置" class="headerlink" title="Mac 环境安装及配置"></a>Mac 环境安装及配置</h2><h3 id="环境依赖准备"><a href="#环境依赖准备" class="headerlink" title="环境依赖准备"></a>环境依赖准备</h3><p>打开个人电脑，通过终端命令确认系统自带 <code>git</code> 。</p><p>执行 <code>ssh-keygen -t rsa -C &quot;github账号邮箱&quot;</code> 生成ssh密钥后添加到 Github Settings –&gt; SSH and GPG Keys 页面。</p><p>执行 <code>git config --global user.name &quot;Ephen&quot;</code> 和 <code>git config --global user.email 个人邮箱</code> 配置 Git 全局用户名及邮箱。</p><p>登录 <a href="https://nodejs.org/en/download/releases/">node.js 官网历史版本下载页</a>搜索 v12.22.10 （保持与工作电脑上的版本一致）下载 <code>.pkg</code> 的程序安装包，按提示步骤完成安装。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220220153316.png" alt="Node.js MAC 安装包下载"></p><h3 id="项目同步"><a href="#项目同步" class="headerlink" title="项目同步"></a>项目同步</h3><p>到个人目录创建一个分类文件夹，执行 <code>git clone 项目地址</code>命令将默认分支 <code>source</code> 下载到本地。</p><p>执行 <code>npm install hexo-cli -g</code> 安装 Hexo 。</p><blockquote><p>源文件已经通过 git 下载，并直接使用的之前的配置，因此不需要执行 <code>hexo init</code> 来初始化博客了。</p></blockquote><p>执行 <code>npm install</code> 将自动安装 <code>package.json</code> 文件中的全部插件。执行过程中会有一些报错，按照报错提示上强制继续即可。（忘记截图了…）</p><h3 id="本地预览及环境变量"><a href="#本地预览及环境变量" class="headerlink" title="本地预览及环境变量"></a>本地预览及环境变量</h3><p>像在 Windows 上一样输入 <code>hexo s</code> 回车后发现执行不了，一开始还以为是之前 <code>npm install</code> 报错导致 hexo 没装上又重装了一遍，确认装上了后还是不能执行，估计就是环境变量问题了。</p><p>查阅<a href="https://hexo.io/docs/"> Hexo 官方文档</a>后，发现可以使用 <code>npx hexo &lt;command&gt;</code> 命令，测试本地预览无误后开始折腾环境变量配置。</p><p>根据过去的 Unix&#x2F;Linux 经验，通过执行 <code>export PATH=&quot;$PATH:./node_modules/.bin&quot;</code> 后测试验证确实是缺失环境变量，于是试着将 PATH 加到 <code>~/.bash_profile</code> 文件中。退出用户后重新登录，发现并不能自动加载该文件。（由此证明，Hexo 上的官方文档 Guide 不对，需要更新）</p><p>再次求助于度娘，发现 Mac 上默认终端是 zsh （其实可以用一个 <code>echo $SHELL</code> 的命令即可查询），用户环境变量的文件是 <code>~/.zshrc</code>，于是执行以下命令后环境变量配置成功：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;PATH=&quot;$PATH:./node_modules/.bin&quot;&#x27; &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure><h2 id="折腾结束"><a href="#折腾结束" class="headerlink" title="折腾结束"></a>折腾结束</h2><p>通过前述设置后，每次写文章前先 <code>git pull</code> 下载源文件，写完文章后除了 Deploy 发布外，还需要记得同时更新下 Github 上的 source 主分支。</p><p>当然，如果还未写完就准备换电脑续写的话，就只用更新 source 而无需 deploy 发布。</p><p>本篇文章即通过个人电脑写一半后，到公司用工作电脑续写完成。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;一个月前，公司资产部在一年一度处理离职员工回收的资产时，我获得了一台 MacBook Air 。&lt;/p&gt;
&lt;p&gt;由于过去从未用过 Mac ，在摸清了大致的用法后，突然想再折腾下博客。&lt;/p&gt;
&lt;p&gt;之前我没有个人电脑，每次更换工作电脑（均为 Windows 操作系统）时，直接用 U 盘复制本地 Hexo 工作目录到新电脑上，安装相关依赖后使用。&lt;/p&gt;
&lt;p&gt;这次准备把新到的 MacBook Air 作为我的个人电脑使用，然后让个人电脑和工作电脑都可以用来更新博客，所以需要考虑 Hexo 源文件多端同步了。&lt;/p&gt;</summary>
    
    
    
    <category term="博客折腾" scheme="https://ephen.me/categories/MyBlog/"/>
    
    
    <category term="hexo" scheme="https://ephen.me/tags/hexo/"/>
    
    <category term="git" scheme="https://ephen.me/tags/git/"/>
    
    <category term="mac" scheme="https://ephen.me/tags/mac/"/>
    
  </entry>
  
  <entry>
    <title>记录下多年未更新博客的后遗症</title>
    <link href="https://ephen.me/2022/blog-sequela/"/>
    <id>https://ephen.me/2022/blog-sequela/</id>
    <published>2022-02-15T16:00:00.000Z</published>
    <updated>2023-05-25T05:57:27.522Z</updated>
    
    <content type="html"><![CDATA[<p>朋友网站换链接了，到 <a href="https://telegram.me/imephen">Telegram</a> 上提醒我更新下友链。本以为不就是改个链接嘛，没想到问题接踵而至。果然太长时间没动过的东西，没有想象中那么简单。</p><p>本次更新发现的主要后遗症列表：</p><ol><li>多个朋友发生域名更换及闭站或撤链；</li><li>hexo &amp; git 命令都忘了怎么用；</li><li>Coding Pages 服务已关闭；</li><li>hexo generate 生成空文件，造成网页白屏；</li><li>博客头像、标签、菜单和分类均加载失败；</li></ol><p>以下详述。</p><span id="more"></span><h2 id="友链更新"><a href="#友链更新" class="headerlink" title="友链更新"></a>友链更新</h2><p>一个个的检查现有友链后，将能找到私下联系方式的朋友确认换域名、闭站及撤链情况，将友链都更新好。有些找不到联系方式的朋友，我就直接撤链了。</p><p>因此事实证明，友链这东西，一定要<strong>先友后链</strong>，否则自己是怎么被撤链的都不知道。</p><h2 id="部署问题"><a href="#部署问题" class="headerlink" title="部署问题"></a>部署问题</h2><p>如前文《<a href="/2016/hello-hexo/">全新出发，正式启用 Hexo ！</a>》所述，我原本是启用了个人云主机、Github Page 和 Coding Page 多点部署的。</p><p>这次更新完友链后，直接执行 <code>hexo g</code> 和 <code>hexo d</code> 准备发布，发现 Coding 出现报错。去搜索了下，才发现我曾经收到过如下邮件：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220216150100.png" alt="Coding Page 服务关闭"></p><p>于是屏蔽掉 Coding deploy 配置，重新执行 <code>hexo d</code> ，发现 Github 提示 <code>nothing commit</code> 。度娘了下，<strong>删除掉 <code>.deploy_git</code> 文件夹后解决</strong>。想来可能是因为我换电脑本地数据迁移时未验证迁移配置的缘故吧~</p><p>接着，上云主机运行同步脚本，发现 git 报认证错误。于是<strong>重新执行 <code>ssh-keygen -t rsa -C &quot;github账号邮箱&quot;</code> 生成ssh密钥后添加到 Github Settings –&gt; SSH and GPG Keys 页面</strong>。再次运行脚本后成功。</p><p>最后，上域名服务商删掉使用 Coding Page 的分区解析。</p><h2 id="网页白屏修复"><a href="#网页白屏修复" class="headerlink" title="网页白屏修复"></a>网页白屏修复</h2><p>本以为做完以上操作一切就绪，当我洋洋得意打开我的博客网站时，居然是一片白。本地执行 <code>hexo s</code> 发现又可以正常显示，这让我一个头两个大。。</p><p>去检查云主机发现，上面的文件都是 0KB ，内容全部为空；接着去 GitHub 上看，文件也是空的；最后才发现本地 <code>/public</code> 目录下的文件居然也是空的！</p><p>那么应该是 <code>hexo generate</code> 命令的问题了，又执行了一遍 <code>hexo clean</code> 和 <code>hexo generate</code> 后确认。于是再次求助度娘，原来是本地 hexo 版本和 node 版本不匹配（hexo 版本低了，node 版本高了）。</p><p>于是，<strong>升级 hexo</strong> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p><strong>降级 node</strong> ：登录 <a href="https://nodejs.org/en/download/releases/">node.js 官网历史版本下载页</a>找到一个 12.x 的版本（我下载的版本是 12.22.10）下载下来，卸载掉本地已安装的 node 后重新安装该版本，然后重新启动。</p><p>再次 <code>hexo clean</code> 后 <code>hexo generate</code> ，<code>/public</code> 目录下的文件已有内容了。</p><p>重新执行 <code>hexo d</code> 成功发布到 Github Page 。到云主机执行脚本时，却一直提示 <code>Already up-to-date</code> ，真是见鬼了。淦！</p><p>直接 <strong><code>rm -rf .</code> 删除掉同步目录，执行 <code>git clone git@github.com:ephen/ephen.github.io.git .</code> 将所有文件重新生成到当前目录</strong>后解决。</p><h2 id="网页-JS-修复"><a href="#网页-JS-修复" class="headerlink" title="网页 JS 修复"></a>网页 JS 修复</h2><p>长吁一口气后再去“欣赏”网站，却怎么也找不到自己的友链入口。仔细一看，头像、标签、分类全都消失了。折腾到此，午饭都没有吃，真是欲哭无泪！</p><p>沉下心来 F12 看看报错，第一个报错如下：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20220216155418.jpg" alt="require,jquery 调用出错"></p><p>看到是引用的文件 CDN 缓存路径出错后，<strong>找到官方路径和代码引用位置进行替换</strong>后解决。</p><p>再次打开网站，终于折腾完毕，其他的报错暂且也不想再看了。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>太久不更新，问题就是多多呀。</p><p>主要是最近几年真的发生了太多事，精力实在有限。要不是有个什么契机，其实也是不想再去折腾了。<del>毕竟我连常用指令都需要去找度娘解决，还有什么用呢？</del></p><p>这里我只是记录下折腾过程，免得日后什么时候弄起来遇到相同问题又要找度娘。</p><p>另外提醒下大家，千万不要学我“暴力 rm”、“未经确认就发布”等行为，一定要养成好习惯哟！~</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;朋友网站换链接了，到 &lt;a href=&quot;https://telegram.me/imephen&quot;&gt;Telegram&lt;/a&gt; 上提醒我更新下友链。本以为不就是改个链接嘛，没想到问题接踵而至。果然太长时间没动过的东西，没有想象中那么简单。&lt;/p&gt;
&lt;p&gt;本次更新发现的主要后遗症列表：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;多个朋友发生域名更换及闭站或撤链；&lt;/li&gt;
&lt;li&gt;hexo &amp;amp; git 命令都忘了怎么用；&lt;/li&gt;
&lt;li&gt;Coding Pages 服务已关闭；&lt;/li&gt;
&lt;li&gt;hexo generate 生成空文件，造成网页白屏；&lt;/li&gt;
&lt;li&gt;博客头像、标签、菜单和分类均加载失败；&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;以下详述。&lt;/p&gt;</summary>
    
    
    
    <category term="博客折腾" scheme="https://ephen.me/categories/MyBlog/"/>
    
    
    <category term="hexo" scheme="https://ephen.me/tags/hexo/"/>
    
    <category term="node" scheme="https://ephen.me/tags/node/"/>
    
    <category term="git" scheme="https://ephen.me/tags/git/"/>
    
    <category term="jquery" scheme="https://ephen.me/tags/jquery/"/>
    
  </entry>
  
  <entry>
    <title>bind 9.12 stable 版 dig 工具有问题，请更新或回退！（附 Windows dig 安装方法）</title>
    <link href="https://ephen.me/2019/bind9-12-dig/"/>
    <id>https://ephen.me/2019/bind9-12-dig/</id>
    <published>2019-04-25T16:00:00.000Z</published>
    <updated>2023-05-25T05:57:05.120Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>查看安装方法请直接跳转至：<a href="/2019/bind9-12-dig/#Windows-%E4%B8%8A%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85-dig-%E5%B7%A5%E5%85%B7%EF%BC%9F">Windows 上如何安装 dig 工具？</a></p></blockquote><p>前段时间又开始捣鼓网络 &amp; DNS 了，于是去 <a href="https://www.isc.org/downloads/"> Bind9 官方 </a> 去下载了一个最新稳定版 Windows 环境的 Bind 。</p><p>当时 Bind 9.14.1 还未正式发布为稳定版，所以我下载的版本是 9.12.3-P1 。下载完成后，安装到我的本地 PC 上。</p><p>随后我在<strong>使用这个版本的 dig 时，只要不指定 DNS 服务器就没有返回，每次使用该工具时必须指定 DNS 服务器。</strong></p><p><img src="https://iephen.pek3b.qingstor.com/b_image/digproblem.jpg" alt=" dig 12 版本有问题 "></p><span id="more"></span><p>起初我以为是公司办公网络环境自动获取设置的本地 DNS 地址有问题，看也能使用就没怎么放在心上。</p><p>刚刚又在使用时，我突然想好好查看一番。Google 了一圈没有搜到结果。于是只好自己查问题了啵。</p><p><strong>网络抓包并没有抓到任何 DNS 请求！</strong></p><p><img src="https://iephen.pek3b.qingstor.com/b_image/capture.jpg" alt=" 抓包没有 dns 请求 "></p><p>换 DNS 配置、换手机热点做网络环境的一番折腾，依然还是这样！开始决定要不换个旧点的版本试试。</p><p>重新下载版本 bind 9.11.6-P1 安装后，没问题了鸭！</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/versionchange.jpg" alt=" dig 9.11.6-P1 版没问题 "></p><p>真是喜极而泣。</p><p>下载了目前最新稳定版 bind 9.14.1 又试了下，也没有问题。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/dig914.jpg" alt=" dig 9.14.1 版没问题 "></p><p><strong>如果你和我一样正在使用 dig 9.12.3-p1 版，为不影响使用，记得将软件升级或回退哦。</strong></p><h2 id="Windows-上如何安装-dig-工具？"><a href="#Windows-上如何安装-dig-工具？" class="headerlink" title="Windows 上如何安装 dig 工具？"></a>Windows 上如何安装 dig 工具？</h2><p>最简单的方法，到官网下载相应版本 Bind 后，解压。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/binddir.jpg" alt=" Bind 源程序解压 "></p><p>使用管理员运行 <code>BINDInstall.exe</code> ，指定本地安装目录。</p><p>如果只想安装 dig ，安装选项选择 <code>Tools Only</code> 即可。如下图所示：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/bindinstall.jpg" alt=" 安装 dig "></p><p>是不是很简单鸭~</p><p>不太记得是不是需要自己加下环境变量，要是小伙伴<strong>安装后不能像我一样直接在 CMD 里不指定目录使用 dig ，那就需要添加下 PATH 。</strong></p><p><img src="https://iephen.pek3b.qingstor.com/b_image/paths.jpg" alt=" 添加环境变量 "></p><p>我个人的环境变量有些多，涂画得乱起八糟，请勿见怪。</p><p>虽说这种安装方法不够绿色，不过这是最快且最好上手的方式了。</p><p>想要绿色一点，就需要自己把 dig 程序和其应用的 DLL 库都收集起来放到一个文件夹里，然后再将此文件夹添加到 PATH 即可。</p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;查看安装方法请直接跳转至：&lt;a href=&quot;/2019/bind9-12-dig/#Windows-%E4%B8%8A%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85-dig-%E5%B7%A5%E5%85%B7%EF%BC%9F&quot;&gt;Windows 上如何安装 dig 工具？&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;前段时间又开始捣鼓网络 &amp;amp; DNS 了，于是去 &lt;a href=&quot;https://www.isc.org/downloads/&quot;&gt; Bind9 官方 &lt;/a&gt; 去下载了一个最新稳定版 Windows 环境的 Bind 。&lt;/p&gt;
&lt;p&gt;当时 Bind 9.14.1 还未正式发布为稳定版，所以我下载的版本是 9.12.3-P1 。下载完成后，安装到我的本地 PC 上。&lt;/p&gt;
&lt;p&gt;随后我在&lt;strong&gt;使用这个版本的 dig 时，只要不指定 DNS 服务器就没有返回，每次使用该工具时必须指定 DNS 服务器。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://iephen.pek3b.qingstor.com/b_image/digproblem.jpg&quot; alt=&quot; dig 12 版本有问题 &quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="工具介绍" scheme="https://ephen.me/categories/tools/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="bind" scheme="https://ephen.me/tags/bind/"/>
    
    <category term="dig" scheme="https://ephen.me/tags/dig/"/>
    
    <category term="Windows" scheme="https://ephen.me/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>首汽瑞卡便利租车怎么样？辣鸡霸王条款霸气客服气哭灰姑娘！</title>
    <link href="https://ephen.me/2019/laji-reocar/"/>
    <id>https://ephen.me/2019/laji-reocar/</id>
    <published>2019-03-28T16:00:00.000Z</published>
    <updated>2022-02-28T03:03:09.920Z</updated>
    
    <content type="html"><![CDATA[<p>如今互联网时代，已经变成了一个服务至上的时代。每个人口袋里都揣着一点小钱，购买物品时贵点便宜点已不再那么重要。</p><p>总的来说，服务态度第一，趣味性第二，价值较高的东西再考虑下性价比。如果我花点儿小钱，能买来当爷的感受，那还真真是极好的。</p><p>但是有些公司，花钱买的是罪受。熟悉灰姑娘的朋友都知道，佛性、随缘、细节，基本就是贯穿日常生活和工作的关键词。可是这么一家公司，生生的把这样的灰姑娘给气哭了！</p><p>路过的小伙伴，如果你不想花钱买罪受，记住这家公司的名字：<strong>瑞卡租车</strong>  <strong>瑞卡便利租车</strong>  <strong>首汽集团</strong>  <strong>Reocar</strong>  <strong>Reocar888</strong></p><p>到底发森了什么？且听我娓娓道来。</p><span id="more"></span><h2 id="选择瑞卡下订单"><a href="#选择瑞卡下订单" class="headerlink" title="选择瑞卡下订单"></a>选择瑞卡下订单</h2><p>灰姑娘老家离武汉近事情多，又想远离养车的麻烦，自从申领驾照后日常租车出行已作为周末首选。作为一只好奇心强喜欢体验各种产品的产品汪，在薅完滴滴羊毛、神州租车、一嗨租车以及各种分时租车 P2P 租车体验过后，上网搜索新目标的种子已种下。</p><p>于是瑞卡便利租车 APP 便于 2018 年 11 月 安装到了手机中，尽管当时因送了 0 元首租优惠券第一印象还行，然而一直没有使用。</p><p>原因：</p><ol><li>因我租车比较多，各种问题也遇到过，因而不习惯买不计免赔，而瑞卡租车的优惠券必须搭配驾无忧不计免赔使用，价格贵且操作起来比较复杂；</li><li>App 的操作 bug 有些多，不够清真，想看看瑞卡对于互联网功能及 bug 的更新速度能否让人满意；</li><li>价格不仅没有优势，哪怕是用完优惠券与其他租车相比也反而较贵（当然有一说一，其他家是没有勾选不计免赔的价了）；</li></ol><p>接下来的这几个月间，中间都有过几次租车，也顺便去看看这个 App ，App 有过一次更新，bug 也修复了。中间有次注意到新人优惠券时间限制是到 2019-3-20 ，就想着啥时候体验一把。</p><p>也就是 3 月 20 日这天，我们做了清明节出行的计划，我打开瑞卡租车 App ，神奇的发现新人优惠券延期到了 2019-7-20 ，瞬间好感倍增，当即就在瑞卡下了订单！</p><p>然而，噩梦才刚刚开始。</p><h3 id="新人优惠券根本就是摆设"><a href="#新人优惠券根本就是摆设" class="headerlink" title="新人优惠券根本就是摆设"></a>新人优惠券根本就是摆设</h3><p>瑞卡租车的规定颇多，节假日不能用优惠券，优惠券的使用必须绑定驾无忧不计免赔。</p><p>综合考虑后，觉得这种优惠券不使用也罢，权当那个公司的高超运营手段一笑而过。都是成年人，懂。</p><h3 id="节假日时间瑞卡说了算"><a href="#节假日时间瑞卡说了算" class="headerlink" title="节假日时间瑞卡说了算"></a>节假日时间瑞卡说了算</h3><p>其他租车软件，遇到节假日也会涨价，也就涨价不定义原因，大家都懂的。</p><p>瑞卡租车，用大大的红字在日期上标明“清明节”，国家法定假日 3 天，它标了 6 天。</p><p>拖动时间表，可以看到，任何节假日，在瑞卡租车 App 上，时间几乎都会比法定假日多出一倍。</p><p>你们这么定义节日，国家知道吗？</p><hr><p>不过这两点无所谓了，反正 App 上看着很明显，不按规则出牌操作过不去、订单也下不了。</p><h2 id="退改风波"><a href="#退改风波" class="headerlink" title="退改风波"></a>退改风波</h2><p>针对前面瑞卡租车的运营尿性，我在支付订单的时候特意看过退改规则。记得说是取车时间前 6 小时可退（只怪我没截图），于是记住这个时间安心付款。</p><p>恰逢三天前因一些事儿导致行程有变准备改到本周末，于是我打开 App 准备修改订单。（这时候 App 又有更新了，看起来状态还挺让人满意）</p><p>发现没有修改入口（页面上只有“取消”按钮），对这种公司的互联网体验我一向没有过多的要求，想想反正能取消就重新下了一个今天晚上的订单。</p><p>再去点“取消”就特么傻眼了。</p><h3 id="取消订单需联系客服"><a href="#取消订单需联系客服" class="headerlink" title="取消订单需联系客服"></a>取消订单需联系客服</h3><p>点了“取消”按钮后，文字提示清明节订单需电话联系客服。由于当时已是晚上 11 点多，尽管我还赶在加班回家的路上，但我依然考虑到别人客服也需要休息，取消订单也不是什么很紧急的事儿我还有时间，电话就没有拨。</p><p>昨天第一次拨了瑞卡租车的客服电话，本以为是一件简单的取消订单的事儿而且我提前了这么久，哪知道还有新的幺蛾子？</p><h3 id="节假日订单取消需要收取违约金"><a href="#节假日订单取消需要收取违约金" class="headerlink" title="节假日订单取消需要收取违约金"></a>节假日订单取消需要收取违约金</h3><p>客服：<code>节假日订单提前 3 天取消需要收取 30% 的违约金，这是合同规定，您在支付前我们有提醒的。</code></p><p>我：<code>我记得支付前说的是提前 6 小时可以免费取消，而且我现在在订单的退改规则中并没有看到这项规定，对于这个合同条款我不知情。</code></p><h3 id="你不信现在下个清明节订单看看？"><a href="#你不信现在下个清明节订单看看？" class="headerlink" title="你不信现在下个清明节订单看看？"></a>你不信现在下个清明节订单看看？</h3><p>客服抢答：<code>你不信现在下个清明节订单看看？</code></p><p>抢答得快，现在看来其实是早就预演好了的。当时还傻傻的去跟她理论：<code>我刚刚打开 App 发现有升级，现在下的订单不能代表当时的标准。</code></p><p>并且还期望有好的结果：<code>而且我是第一次使用贵司产品的新客户，您看看可否通融一下？</code></p><p>客服：<code>好的，您的问题我已为您记录。请保持通讯畅通，我们将在 48 小时内回复您。</code></p><h3 id="真的需要等-48-小时的！"><a href="#真的需要等-48-小时的！" class="headerlink" title="真的需要等 48 小时的！"></a>真的需要等 48 小时的！</h3><p>我自己也做过运营，也接触过别的客服团队，48 小时当然往往是己方最低处理限度的说辞嘛，一般也就十几二十分钟就能联系客户。</p><p>然而，我左等右等没有回音，一直等到 25 小时后的今天中午，我实在有点儿生气，又给他们客服去了电话。</p><p>客服：<code>您再等 48 小时好吗？</code></p><p>我终于火了，说：<code>我昨天反馈的，为何还要等 48 小时？你最好 1 小时之内给我回复处理结果，我今天晚上有一个订单，没有满意的处理结果我就把两个订单都取消掉。</code></p><p>客服就说他们的处理时限就是 48 小时的，只能尽快，要我保持耐心。</p><p>我问我等过了 48 小时今天的订单是不是就不能免费退了，客服回复普通订单提前 2 小时可以免费取消。我怒气冲冲的让他们 1 小时之内给我答复便挂了电话。</p><h2 id="灰姑娘终于被气哭了"><a href="#灰姑娘终于被气哭了" class="headerlink" title="灰姑娘终于被气哭了"></a>灰姑娘终于被气哭了</h2><p>等了 20 分钟，仍然没有瑞卡租车的电话回访，于是再次电话催。</p><h3 id="您打过电话吗？"><a href="#您打过电话吗？" class="headerlink" title="您打过电话吗？"></a>您打过电话吗？</h3><p>上来就报一通资料姓名，问其上报处理结果怎么样了，怎么还没有电话回访。</p><p>客服比我还无辜的声音传来：<code>您什么时候打的电话？您打过电话吗？</code></p><h3 id="修改订单多不退少要补"><a href="#修改订单多不退少要补" class="headerlink" title="修改订单多不退少要补"></a>修改订单多不退少要补</h3><p>我再次报一通资料姓名，完完整整的复述一遍之前讲过的内容，并且告知她我原意只是修改订单而瑞卡不支持修改，第一次使用它们的产品并且没有看到任何合同条款。</p><p>客服：<code>那您应该让我们帮您修改订单呀？</code></p><p>我：<code>那你给我把今天的订单取消，把清明节的订单修改到今天晚上。</code></p><p>客服：<code>好的。我们修改订单是不退还差价的，您确认要这么操作吗？</code></p><p>我：<code>那我普通订单修改到节假日，要不要补差价？</code></p><p>客服：<code>要的。</code></p><h3 id="要打-12315-请自便"><a href="#要打-12315-请自便" class="headerlink" title="要打 12315 请自便"></a>要打 12315 请自便</h3><p>此刻我真的气炸了，说他侵犯消费者知情权，要打 12315 投诉他们。</p><p>客服小姐姐温柔的声音传来：<code>这个是您的权益的。</code> 并且主动挂断了电话。</p><p>眼泪夺眶而出，哪有这么欺负人的。</p><p>情绪已非常不稳定，再次给他们去了电话，质问他们为何要挂我电话，对方又开始装傻。</p><hr><p>老公看我泪眼汪汪，他安慰我不要急躁，听他怎么跟对方好好沟通。</p><p>然后他给对方客服打了一通电话，也被气得不行，挂了电话就跟我说：<code>两个订单都取消了吧，赶紧上神州租车订，亏点就亏点。</code></p><p>我再次电话瑞卡租车客服让取消我的两个订单，除了告知要收取 30% 的违约金外，没有问任何原因。</p><p>挂了电话，我甚至觉得对方的语气中似乎还透露着一丝开心？</p><p>现在回头想想也真是，他们那么复杂的节假日订单及优惠券运营规则都自助服务了，怎么会在“修改”和“取消”上不做点文章呢？</p><h2 id="附：租车服务推荐排序"><a href="#附：租车服务推荐排序" class="headerlink" title="附：租车服务推荐排序"></a>附：租车服务推荐排序</h2><ol><li><strong>怀念的滴滴租车</strong>：车辆都很新，默认配有倒车雷达、手机支架及 USB 充电器，员工服务态度非常好，价格也便宜（我秒过很多次 9 元租车），除了需要赔偿时价格过高，其他全方位都挺好。可惜业务下架了，其实还是透露出一些运营策略上的问题，如果能学到辣鸡瑞卡的一半，应该还不至于死。</li><li><strong>一嗨租车</strong>：租车行业里面坚挺多年了，日常活动很多优惠也多，价格会一直随时间波动（节假日几乎指数级波动），时间把握得好会是最便宜的，官方客服态度不错。需要赔偿时定价也高但 App、合同及门店都有醒目的位置提示，取车服务态度看门店看人，有次租车有些小剐蹭我们主动跟验车人员说了都没让赔。</li><li><strong>神州租车</strong>：客服以及取车服务态度都非常好，只是车经常会比较旧。有次小剐蹭我们没说，验车人员应该是看见了停留了蛮久但是也没说什么。日常大多数价格会比一嗨贵一点，偶尔会便宜一些，整体来说差不多。</li></ol><hr><p>辣鸡瑞卡，吃枣药丸！ 12315 有没有用也要走起。</p><p>且看你还能骗取几个新人违约金。</p><p>那些交了什么轻松租会员押金的傻子们，等你找他们退押金的时候怕不是要哭死你。</p><p>诅咒这公司明年过个愉快的清明节，到时候知情的小伙伴记得通知我去烧纸。</p><p>再次告诫路过的小伙伴，如果你不想花钱买罪受，记住这家公司的名字：<strong>瑞卡租车</strong>  <strong>瑞卡便利租车</strong>  <strong>首汽集团</strong>  <strong>Reocar</strong>  <strong>Reocar888</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;如今互联网时代，已经变成了一个服务至上的时代。每个人口袋里都揣着一点小钱，购买物品时贵点便宜点已不再那么重要。&lt;/p&gt;
&lt;p&gt;总的来说，服务态度第一，趣味性第二，价值较高的东西再考虑下性价比。如果我花点儿小钱，能买来当爷的感受，那还真真是极好的。&lt;/p&gt;
&lt;p&gt;但是有些公司，花钱买的是罪受。熟悉灰姑娘的朋友都知道，佛性、随缘、细节，基本就是贯穿日常生活和工作的关键词。可是这么一家公司，生生的把这样的灰姑娘给气哭了！&lt;/p&gt;
&lt;p&gt;路过的小伙伴，如果你不想花钱买罪受，记住这家公司的名字：&lt;strong&gt;瑞卡租车&lt;/strong&gt;  &lt;strong&gt;瑞卡便利租车&lt;/strong&gt;  &lt;strong&gt;首汽集团&lt;/strong&gt;  &lt;strong&gt;Reocar&lt;/strong&gt;  &lt;strong&gt;Reocar888&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;到底发森了什么？且听我娓娓道来。&lt;/p&gt;</summary>
    
    
    
    <category term="心情驿站" scheme="https://ephen.me/categories/emo/"/>
    
    
  </entry>
  
  <entry>
    <title>又来折腾博客了</title>
    <link href="https://ephen.me/2019/blog-update/"/>
    <id>https://ephen.me/2019/blog-update/</id>
    <published>2019-03-07T16:00:00.000Z</published>
    <updated>2023-05-25T05:57:51.413Z</updated>
    
    <content type="html"><![CDATA[<p>博客好久没有更新了，难得妇女节放半天假有个好心情。</p><p>本次更新点：</p><ol><li>修改 favicon 图标；</li><li>增加原创版权声明；</li><li>增加支付宝&amp;微信打赏码；</li><li>部分样式调整；</li></ol><p>其实都是一些比较小的更新，原本也没有什么好值得一提的，主要就聊聊相关的改造想法吧。</p><span id="more"></span><h2 id="修改-favicon-图标"><a href="#修改-favicon-图标" class="headerlink" title="修改 favicon 图标"></a>修改 favicon 图标</h2><p>过去我的 Favicon 其实是用 CloudXNS 的产品 Logo 微调了下颜色而来，有些小伙伴表示并看不出什么差别。</p><p>转眼间，我已离开世纪互联快一年了，现在依然用着这个 Logo 还真的是不太合适。就考虑重新设计，并顺便了解下射击师的日常。</p><p>刚好捉到一来武汉出差的美女射击师，让她先教我画这个简单的风车。掌握到方法后，我又画了各种各样的风车。也尝试画了一些别的图案，并挑选了一些我觉得画得还行的一个个应用到本地博客上试。最终选了现在用的这个，跟之前的差别没有太大，但还是能明显看得到差别。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/favicons_test.jpg" alt="blog favicon"></p><p><strong>立个 Flag ：<del>以后每年都换一次自己设计的 Favicon</del> （请假装没看见……</strong></p><h3 id="一点感悟"><a href="#一点感悟" class="headerlink" title="一点感悟"></a>一点感悟</h3><p>设计真的是需要有丰富的想象力和创意的事情，当看到成果的时候所有前期的焦头烂额都觉得值得，很容易带来成就感和满足感；而它又是一个特别容易让人陷入细节的事情，哪怕是一个像素的差异都会耿耿于怀非要修正不可，也容易让人迷失方向忘记初衷。</p><h2 id="原创版权声明"><a href="#原创版权声明" class="headerlink" title="原创版权声明"></a>原创版权声明</h2><p>本博勉强称之为原创技术博吧，过去我没有加过版权声明。之前有些文章是同时在老东家当作官方技术博文来发的，被转载的不少，并且也不太好去要求那些地方加上转载来源。现在，我打算日后首发原创就来自这里，并声明一下版权。还望路过的有转载 or 改编意图的小伙伴，别忘了附上我的原文地址。</p><p>不过现在越来越懒得写技术博文了，工作生活繁忙又没啥动力。哎……（我差不多是一只废喵了。</p><h2 id="请赐予我动力"><a href="#请赐予我动力" class="headerlink" title="请赐予我动力"></a>请赐予我动力</h2><p>我是个乐意传授知识的人。这破博虽没什么流量，但隔三岔五收到邮件或 Telegram 消息咨询问题的也不少，我都有一一认真回答。</p><p>其实想写的主题有不少，我的博客 to do list 上都排着呢。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426145923.png" alt=" ToDoList "></p><p>当然，这个列表排了好几个月了，很有可能有些东西都过时了，最终也不一定兑现发布。</p><p>这次博客更新，我在每篇原创博文下都有提供支付宝和微信二维码，路过的小伙伴随意打赏以赐予我更新的动力吧。（请不要说我的码太丑，我可是花了好多心思来设计的呢！<del>这下本灰灰的审美问题已众所周知</del></p><h3 id="O-∩-∩-O"><a href="#O-∩-∩-O" class="headerlink" title="O(∩_∩)O"></a>O(∩_∩)O</h3><p>其实靠打赏来维持写作动力只是个玩笑辣，写不写、怎么写更多的还是看我自己。哪怕是没有打赏，问我的问题依然会一如既往的认真回复，如果能得到支持当然是更开心咯。</p><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>略微改了下主题里面的内容分割、二级标题、三级标题、引用、代码块等样式。（一切都是因我的渣审美在作祟。</p><p>也没有什么好需要特别说明的。</p><p>为了摆“原创声明”和“赞赏二维码”花了好几天捣鼓也没有搞定，最后也是在公司抓了只前端大神几分钟就给我搞定了。得出结论：<code>果然代码开发是个吃经验的工种，速成彻底宣告失败。</code></p><p><strong>像我这种干啥都三分钟热度的人，真的很需要有人在后边鞭笞我。</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;博客好久没有更新了，难得妇女节放半天假有个好心情。&lt;/p&gt;
&lt;p&gt;本次更新点：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;修改 favicon 图标；&lt;/li&gt;
&lt;li&gt;增加原创版权声明；&lt;/li&gt;
&lt;li&gt;增加支付宝&amp;amp;微信打赏码；&lt;/li&gt;
&lt;li&gt;部分样式调整；&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;其实都是一些比较小的更新，原本也没有什么好值得一提的，主要就聊聊相关的改造想法吧。&lt;/p&gt;</summary>
    
    
    
    <category term="博客折腾" scheme="https://ephen.me/categories/MyBlog/"/>
    
    
    <category term="hexo" scheme="https://ephen.me/tags/hexo/"/>
    
    <category term="版权" scheme="https://ephen.me/tags/copyright/"/>
    
  </entry>
  
  <entry>
    <title>闲聊 DNS 系统中域名的格式标准：下划线“_”是被允许的吗？</title>
    <link href="https://ephen.me/2019/zone-format/"/>
    <id>https://ephen.me/2019/zone-format/</id>
    <published>2019-02-28T16:00:00.000Z</published>
    <updated>2023-05-25T06:04:51.368Z</updated>
    
    <content type="html"><![CDATA[<p>朋友最近在做解析配置的时候遇到问题，因 gitlab 域名所有权验证时提供的 host 是 <code>_gitlab-pages-verification-code</code> 被解析商认为域名不符合标准而拒绝填写，便来与我讨论：<strong>域名的格式标准是什么？到底是否可以有下划线呢？</strong></p><p>虽说没事去研究<code>“茴”字有几种写法</code>着实有些多此一举，不过偶尔在做些研究时带点儿孔乙己精神还是挺好玩的一件事儿。</p><p>其实关于下划线的争议，我估计也不是一天两天了。国内外一些解析商的标准都是各有不同，而一些需要配置域名解析的商家提供的要求也是五花八门。比如最常见的邮件服务提供商，它们的 MX、SPF、DomainKey 等要求非专业人员要弄懂得费可大的力气。</p><p>今天灰姑娘就来从标准规范中剖析闲聊域名格式标准的那些事。</p><span id="more"></span><p><strong>想直接看结论的童鞋可直接点击左侧文章目录跳转。</strong></p><h2 id="RFC-1034-amp-RFC-1035"><a href="#RFC-1034-amp-RFC-1035" class="headerlink" title="RFC-1034 &amp; RFC-1035"></a>RFC-1034 &amp; RFC-1035</h2><p><a href="https://tools.ietf.org/html/rfc1034">RFC 1034</a> 和 <a href="https://tools.ietf.org/html/rfc1035">RFC 1035</a> 是专门讲 DNS 以及域名基础的标准，业内也常常将这两篇拿出来分析和培训。</p><p>关于域名的格式，这两篇中有内容相同的段落来具体描述，RFC-1034 的 3.5 章节和 RFC-1035 的 2.3.1 章节。以下摘取自 RFC-1034 ：</p><blockquote><p>3.5. Preferred name syntax</p><p>The DNS specifications attempt to be as general as possible in the rules for constructing domain names.  The idea is that the name of any existing object can be expressed as a domain name with minimal changes. However, when assigning a domain name for an object, the prudent user will select a name which satisfies both the rules of the domain system and any existing rules for the object, whether these rules are published or implied by existing programs.</p><p>For example, when naming a mail domain, the user should satisfy both the rules of this memo and those in RFC-822.  When creating a new host name, the old rules for HOSTS.TXT should be followed.  This avoids problems when old software is converted to use domain names.</p><p>The following syntax will result in fewer problems with many applications that use domain names (e.g., mail, TELNET).</p><p><code>&lt;domain&gt; ::= &lt;subdomain&gt; | &quot; &quot;</code><br><code>&lt;subdomain&gt; ::= &lt;label&gt; | &lt;subdomain&gt; &quot;.&quot; &lt;label&gt;</code><br><code>&lt;label&gt; ::= &lt;letter&gt; [ [ &lt;ldh-str&gt; ] &lt;let-dig&gt; ]</code><br><code>&lt;ldh-str&gt; ::= &lt;let-dig-hyp&gt; | &lt;let-dig-hyp&gt; &lt;ldh-str&gt;</code><br><code>&lt;let-dig-hyp&gt; ::= &lt;let-dig&gt; | &quot;-&quot;</code><br><code>&lt;let-dig&gt; ::= &lt;letter&gt; | &lt;digit&gt;</code><br><code>&lt;letter&gt; ::= any one of the 52 alphabetic characters A through Z in upper case and a through z in lower case</code><br><code>&lt;digit&gt; ::= any one of the ten digits 0 through 9</code></p><p>Note that while upper and lower case letters are allowed in domain names, no significance is attached to the case.  That is, two names with the same spelling but different case are to be treated as if identical.</p><p><strong>The labels must follow the rules for ARPANET host names.  They must start with a letter, end with a letter or digit, and have as interior characters only letters, digits, and hyphen.  There are also some restrictions on the length.  Labels must be 63 characters or less.</strong></p><p>For example, the following strings identify hosts in the Internet:</p><p><code>A.ISI.EDU  XX.LCS.MIT.EDU  SRI-NIC.ARPA</code></p></blockquote><p>上面加粗的这一段，便明确指出 <strong>“域名要遵循 ARPANET 的主机名格式：必须以字母开头、以字母或者数字结尾，中间部分为字母、数字或连字符，长度必须是 63 个字符或者更短。”</strong></p><p>从这里，我们可以看出，下划线“_”是不被允许的，无论它在什么位置。但有意思的是，从这描述上来看，数字竟然也是不允许放在开头的！</p><p>我们知道，在做反向域名解析的时候，需要指定的 IP 除了最后的<code>in-addr.arpa</code>和<code>ip6.arpa</code>前面就都是纯数字。所以，会不会是这个标准有什么问题呢？</p><h3 id="学会查阅-RFC"><a href="#学会查阅-RFC" class="headerlink" title="学会查阅 RFC"></a>学会查阅 RFC</h3><p>这里顺便提一下，我们通常在查阅 RFC 的时候，多是关注该文档的内容，但其实也要关注下文档的发布信息。</p><p>以下是 RFC-1034 的发布信息：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426150600.png" alt=" rfc1034 comment "></p><p>它明确的表明了这份标准：</p><ol><li>发布于 1987 年 11 月，是因特网标准。</li><li>存在勘误，RFC 1101, 1183, 1348, 1876, 1982, 2065, 2181, 2308, 2535, 4033, 4034, 4035, 4343, 4035, 4592, 5936, 8020, 8482 对本标准有所更新。</li><li>淘汰了 882, 883, 973 这三个 RFC 标准。</li></ol><p>顶上的链接除了提供各种格式的查看方式外，还有文档跟踪及勘误表。我们可以去勘误表里面查查看都有哪些问题，而后去更新的文档里面找找还有没有我们需要的内容。</p><h2 id="数字能否放到开头？"><a href="#数字能否放到开头？" class="headerlink" title="数字能否放到开头？"></a>数字能否放到开头？</h2><p>通过查阅勘误表，大致也就能发现几个英文拼写或语法错误。通过追踪接下来的更新标准，我找到了前面关于反向域名的格式疑惑。</p><p>以下节选自<a href="https://tools.ietf.org/html/rfc1101"> RFC 1101 </a>：</p><blockquote><p>3.1. Network name syntax</p><p>The current syntax for network names, as defined by [RFC 952] is an alphanumeric string of up to 24 characters, which begins with an alpha, and may include “.” and “-“ except as first and last characters.  This is the format which was also used for host names before the DNS.  Upward compatibility with existing names might be a goal of any new scheme.</p><p>However, the present syntax has been used to define a flat name space, and hence would prohibit the same distributed name allocation method used for host names.  There is some sentiment for allowing the NIC to continue to allocate and regulate network names, much as it allocates numbers, but the majority opinion favors local control of network names.  Although it would be possible to provide a flat space or a name space in which, for example, the last label of a domain name captured the old-style network name, any such approach would add complexity to the method and create different rules for network names and host names.</p><p>For these reasons, we assume that the syntax of network names will be the same as the expanded syntax for host names permitted in [HR]. <strong>The new syntax expands the set of names to allow leading digits, so long as the resulting representations do not conflict with IP addresses in decimal octet form.</strong>  For example, <code>3Com.COM</code> and <code>3M.COM</code> are now legal, although <code>26.0.0.73.COM</code> is not.  See [HR] for details.</p></blockquote><p>还是注意加粗的这段话，它表明：<strong>新的语法标准允许以数字开头，但结果不能与十进制八位字节形式的 IP 地址冲突。</strong></p><p>更多信息大家可以自行去查看，最终 RFC-1101 定义了基于网络名称的 DNS 编码规范。</p><p>那么，网易家的<code>163.com</code>也合法了。</p><h2 id="下划线“-”到底能不能允许存在呢？"><a href="#下划线“-”到底能不能允许存在呢？" class="headerlink" title="下划线“_”到底能不能允许存在呢？"></a>下划线“_”到底能不能允许存在呢？</h2><p>事实上，域名系统可以看做一种用来存储具备层级关系的数据的服务。随着互联网的发展，DNS 能做的事儿越来越多，对主机名格式的定义也开始越来越宽容。</p><p>于是，于 1997 年发布的 <a href="https://tools.ietf.org/html/rfc2181">RFC-2181</a> 再次对域名语法格式做了澄清：</p><blockquote><ol start="11"><li>Name syntax</li></ol><p>Occasionally it is assumed that the Domain Name System serves only the purpose of mapping Internet host names to data, and mapping Internet addresses to host names.  This is not correct, the DNS is a general (if somewhat limited) hierarchical database, and can store almost any kind of data, for almost any purpose.</p><p><strong>The DNS itself places only one restriction on the particular labels that can be used to identify resource records.  That one restriction relates to the length of the label and the full name.  The length of any one label is limited to between 1 and 63 octets.  A full domain name is limited to 255 octets (including the separators).  The zero length full name is defined as representing the root of the DNS tree, and is typically written and displayed as “.”.  Those restrictions aside, any binary string whatever can be used as the label of any resource record.</strong>  Similarly, any binary string can serve as the value of any record that includes a domain name as some or all of its value (SOA, NS, MX, PTR, CNAME, and any others that may be added). Implementations of the DNS protocols must not place any restrictions on the labels that can be used.  In particular, DNS servers must not refuse to serve a zone because it contains labels that might not be acceptable to some DNS client programs.  A DNS server may be configurable to issue warnings when loading, or even to refuse to load, a primary zone containing labels that might be considered questionable, however this should not happen by default.</p><p>Note however, that the various applications that make use of DNS data can have restrictions imposed on what particular values are acceptable in their environment.  For example, that any binary label can have an MX record does not imply that any binary name can be used as the host part of an e-mail address.  Clients of the DNS can impose whatever restrictions are appropriate to their circumstances on the values they use as keys for DNS lookup requests, and on the values returned by the DNS.  If the client has such restrictions, it is solely responsible for validating the data from the DNS to ensure that it conforms before it makes any use of that data.</p><p>See also [RFC1123] section 6.1.3.5.</p></blockquote><p>在这份标准文档中，明确了“<strong>除了限制长度（包括每个标签之间的长度以及完整域名总长）外，任何二进制字符串都可以作为任何资源记录的标签</strong>”。</p><p>至此，关于下划线的谜底彻底揭开：<strong>下划线不应被 DNS 服务所拒绝。</strong>不过，上文中也有提到<strong>特殊的应用和场景可以有所限制，但并不是默认的。</strong>通常这种情况下，对应的应用服务往往会有所判断。</p><p>此外，感兴趣的童鞋还可以继续看看上述节选中提到的 <a href="https://tools.ietf.org/html/rfc1123#page-79"> RFC-1123 的 6.1.3.5 章节</a>。</p><h2 id="其他提及"><a href="#其他提及" class="headerlink" title="其他提及"></a>其他提及</h2><p>细心的童鞋可能有看到前面 RFC-1034 中有提到大小写的内容：<strong>仅大小写不一致视为同一域名。</strong> 除此之外，没有提及更多。</p><p>对于这种类似说法可能存在一些不确定性，2006 年 1 月发布的<a href="https://tools.ietf.org/html/rfc4343"> RFC-4343 </a> 再次针对大小写、ASCII 码转义等格式标准做了澄清。</p><p>感兴趣的童鞋可以去看看，我这里就不再引用和释义了。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对于域名格式到底是怎样的，可以参考 AWS Route53 ，他们给了非常完整的定义：<a href="https://docs.aws.amazon.com/zh_cn/Route53/latest/DeveloperGuide/DomainNameFormat.html"> DNS 域名格式 </a></p><p>总的来说有如下几个关键要点：</p><ol><li>长度限制：每个 label 之间 63 个字符以内，域名全长（含所有的“.”，包括根）不超过 255 个字符；</li><li>不区分大小写，常规默认小写；</li><li>特殊字符：需要用<code>\三位八进制 ASCII 码</code>格式转义；</li><li>中、日、韩等非拉丁文字符域名：需要进行 punycode 转码 （附：<a href="https://www.punycoder.com/">在线 punycode 转码工具：Punycoder</a>）；</li></ol><p>值得一提的是，<strong>DNS 业内针对 Zone 一般是“字母、数字和连字符（-），且中划线不能在 label 开头和结束”</strong>。它来自早期已废弃的 RFC-882 &amp; RFC-973 ，业内已约定俗成并非是如今的硬性要求。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;朋友最近在做解析配置的时候遇到问题，因 gitlab 域名所有权验证时提供的 host 是 &lt;code&gt;_gitlab-pages-verification-code&lt;/code&gt; 被解析商认为域名不符合标准而拒绝填写，便来与我讨论：&lt;strong&gt;域名的格式标准是什么？到底是否可以有下划线呢？&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;虽说没事去研究&lt;code&gt;“茴”字有几种写法&lt;/code&gt;着实有些多此一举，不过偶尔在做些研究时带点儿孔乙己精神还是挺好玩的一件事儿。&lt;/p&gt;
&lt;p&gt;其实关于下划线的争议，我估计也不是一天两天了。国内外一些解析商的标准都是各有不同，而一些需要配置域名解析的商家提供的要求也是五花八门。比如最常见的邮件服务提供商，它们的 MX、SPF、DomainKey 等要求非专业人员要弄懂得费可大的力气。&lt;/p&gt;
&lt;p&gt;今天灰姑娘就来从标准规范中剖析闲聊域名格式标准的那些事。&lt;/p&gt;</summary>
    
    
    
    <category term="知识探索" scheme="https://ephen.me/categories/knowledge/"/>
    
    <category term="工作笔记" scheme="https://ephen.me/categories/MyWork/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="RFC" scheme="https://ephen.me/tags/RFC/"/>
    
    <category term="域名格式" scheme="https://ephen.me/tags/zone-format/"/>
    
  </entry>
  
  <entry>
    <title>需要上线多个域名（网站）却只有一个公网 IP 怎么办？</title>
    <link href="https://ephen.me/2018/mutisite-oneip/"/>
    <id>https://ephen.me/2018/mutisite-oneip/</id>
    <published>2018-08-31T12:01:32.000Z</published>
    <updated>2023-05-25T06:02:37.112Z</updated>
    
    <content type="html"><![CDATA[<p>以前做 DNS ，推出过一个系列的《如何让多 ip 域名配置游刃有余》的几篇文章，毕竟作为智能 DNS ，站点多 ip 的配置是其职责所在。</p><p>然而最近，有的小伙伴问题又来了：</p><blockquote><p>没那么多钱申请那么多不同机房的公网 ip ，但又有必要部署多个不咋占资源的站点，又该怎么办呢？</p></blockquote><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426163201.png" alt=" 穷到变形 "></p><p>别急，穷人不止你一个，自然有又穷又聪明的 PM &amp; 技术给出解决方案，啥都能给变出来。</p><span id="more"></span><h2 id="穷到啥都不剩：别说-ip-了，连主机都买不起"><a href="#穷到啥都不剩：别说-ip-了，连主机都买不起" class="headerlink" title="穷到啥都不剩：别说 ip 了，连主机都买不起"></a>穷到啥都不剩：别说 ip 了，连主机都买不起</h2><p>在云计算行业，虚拟化是一个不陌生的词。只要资源够，一台机器可以生出无数台虚拟机来。</p><p> Web 服务上同样也有类似的概念，人们可以通过创建不同的 VirtualHost 指向不同的域名（或端口）和目录，即可实现同一台机器上生出多个不同的站点。</p><p>以 Apache 为例，Apache 安装好后在默认配置中一般有两个重要的配置文件： <code>httpd.conf</code> 和 <code>welcome.conf</code></p><p>其中 <code>httpd.conf</code> 是程序的配置文件，决定了程序将要使用什么组件、监听什么端口、加载什么配置、各类程序文件及日志文件都放到哪里等等；而 <code>welcome.conf</code> 是程序提供的 Web 配置示例，告诉使用者要搭建网站该怎么配置。</p><ul><li>注：Apache 中 Web 站点配置文件名不一定是 <code>welcome.conf</code> ，只要 <code>httpd.conf</code> 文件中有指向，可以是任意的文件名。本文仅以 <code>welcome.conf</code> 做示例。</li></ul><p>我们知道，http 服务的默认端口是 80 ，使用 80 端口则用户在访问时不用刻意在浏览器输入端口号，非常方便。 <code>httpd.conf</code> 文件中默认 <code>Listen 80</code> ，要使用 80 端口，我们只需要配置好 Web 站点即可。</p><p>默认的 <code>welcome.conf</code> 文件内容中的 VirtualHost 配置是这样的（截取关键内容）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/&quot;</span><br><span class="line">    ServerName ephen.me</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><p><code>DocumentRoot</code> 后面的目录表示站点搭建目录， <code>ServerName</code> 表示站点域名。</p><p>如果我们需要配置多个不同的站点，将站点搭建到不同的目录，在该文件中多配置几条 VirtualHost 就好：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost ephen.me:80&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/ephen.me/&quot;</span><br><span class="line">    ServerName ephen.me</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost demo.com:80&gt;</span><br><span class="line">    DocumentRoot &quot;/var/www/html/demo.com/&quot;</span><br><span class="line">    ServerName demo.com</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><p>使用其他的 Web 服务程序，道理是一样的。 Nginx VirtualHost 配置可参考：<a href="http://tabalt.net/blog/nginx-virtual-host/">http://tabalt.net/blog/nginx-virtual-host/</a></p><h2 id="只是有点小气：不差钱，就是只想用一个-ip"><a href="#只是有点小气：不差钱，就是只想用一个-ip" class="headerlink" title="只是有点小气：不差钱，就是只想用一个 ip"></a>只是有点小气：不差钱，就是只想用一个 ip</h2><p>假设多个不同的网站已经在不同的云主机上已搭建好，而目前能提供服务的可用 ip 只有一个。通常咱们会想到要是前面再有一个分发装置用于绑定这个 ip ，然后通过访问端口或域名区分真正到达的主机，那真真是极好的~</p><p>在云计算行业，这个分发装置肯定是有的，就看你怎么用了。</p><p>下文将以 QingCloud 云平台为例，来解决这个问题。</p><h3 id="负载均衡器（-Load-Balancer-）"><a href="#负载均衡器（-Load-Balancer-）" class="headerlink" title="负载均衡器（ Load Balancer ）"></a>负载均衡器（ Load Balancer ）</h3><p>创建负载均衡监听器，监听 80 端口，添加多个后端，然后为这些后端分别绑定不同的转发策略，就能成功满足需求。</p><p>操作步骤示例：</p><ol><li>创建负载均衡器，绑定仅有的一个公网 ip</li></ol><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426163253.png" alt="Load Balancer"></p><ol start="2"><li>为该负载均衡器创建基于 80 端口的 HTTP 监听器，并将已搭建好的几个网站添加为该监听器的后端</li></ol><ul><li>注：我只有一个站点，但不影响后续的示例</li></ul><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426163314.png" alt="HTTP 监听器"></p><ol start="3"><li>为对应的后端添加转发策略，让来自 <code>ephen.me</code> 站点的请求指向对应的后端地址</li></ol><ul><li>注意看上面第二步附图中后端列表倒数第 3 个字段——“转发策略”，点击下面对应的“绑定”二字；</li><li>若没有转发策略可绑，会指引创建：</li></ul><p>  <img src="https://iephen.pek3b.qingstor.com/b_image/20190426163335.png" alt="create forward"></p><ul><li>为转发策略添加规则，选择“按域名转发”：</li></ul><p>  <img src="https://iephen.pek3b.qingstor.com/b_image/20190426163354.png" alt="add rules"></p><ul><li>回到负载均衡监听器，为对应后端添加转发策略</li></ul><p>  <img src="https://iephen.pek3b.qingstor.com/b_image/20190426163416.png" alt="choose forward"></p><p>通过应用上述配置后，即可完成：<strong>用户访问对应 ip 的 80 端口 HTTP 服务，若域名为 <code>ephen.me</code> 则转发至该后端主机。</strong></p><p>如果有存在多台已配置好不同 Web 服务的云主机要共用这个 ip ，只需要继续往这个负载均衡器添加后端主机并绑定不同规则的转发策略就可以了。</p><p>当然，负载均衡器的作用远不仅仅如此，本文的介绍可以看作是为解决问题而抖个机灵罢了。更多的介绍可参照 QingCloud 官网：<a href="https://www.qingcloud.com/products/loadbalancer/">负载均衡_LB Cluster | 青云QingCloud</a></p><h3 id="VPC-网络"><a href="#VPC-网络" class="headerlink" title="VPC 网络"></a>VPC 网络</h3><p>“负载均衡器 + 转发策略”的解决方案确实很好用，但如果多个不同业务的站点已经搭建到不同的云主机，除了 ip 没有多的可用外，连域名都想用同一个，只靠端口号来区分，又该怎么办呢？</p><p>当然负载均衡器也是可以解决的，看到这里的小伙伴可以一起思考下。不过这时候容许灰姑娘再抖个机灵，通过创建“ VPC 网络 + 端口转发”来解决。</p><p>关于 VPC 网络的介绍，可以先看看：<a href="https://www.qingcloud.com/products/vpc/">专属私有网络_VPC | 青云QingCloud</a></p><p>懂的童鞋可跳过，且看操作步骤：</p><ol><li>创建 VPC 网络，绑定仅有的一个公网 ip</li></ol><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426163448.png" alt="VPC"></p><ol start="2"><li>在 VPC 网络中创建一个 vxnet 私有网络，并将业务承载主机加入到这个网络，在开启 DHCP 服务的情况下，它将自动分配到一个私有网络地址</li></ol><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426163534.png" alt="VxNet"></p><ol start="3"><li>管理 VPC 网络配置，添加端口转发，将来自 80 端口的业务转发到私有网络中的这台云主机上</li></ol><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426163552.png" alt="Port Forward"></p><p>通过应用上述配置后，即可完成：<strong>用户访问对应 ip 的 80 端口 HTTP 服务，则转发至私有网络中 ip 地址为<code>192.168.128.2</code>的主机。</strong></p><p>同理，其他业务的云主机，可以都加入到前面已创建好的私有网络并获得各自的私有网络 ip 地址，再设置不同的端口转发到不同的地址就好了。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上只是灰姑娘的个人想法，其实标题所描述的问题解法还有很多，欢迎相互交流。</p><p>也许有些小伙伴的业务过于庞大后会有更多的难题需要解决，不过办法都是人想的，如果有童鞋有别的难题，也欢迎相互交流。</p><p>最后，感谢耐心看完此文。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;以前做 DNS ，推出过一个系列的《如何让多 ip 域名配置游刃有余》的几篇文章，毕竟作为智能 DNS ，站点多 ip 的配置是其职责所在。&lt;/p&gt;
&lt;p&gt;然而最近，有的小伙伴问题又来了：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;没那么多钱申请那么多不同机房的公网 ip ，但又有必要部署多个不咋占资源的站点，又该怎么办呢？&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://iephen.pek3b.qingstor.com/b_image/20190426163201.png&quot; alt=&quot; 穷到变形 &quot;&gt;&lt;/p&gt;
&lt;p&gt;别急，穷人不止你一个，自然有又穷又聪明的 PM &amp;amp; 技术给出解决方案，啥都能给变出来。&lt;/p&gt;</summary>
    
    
    
    <category term="工作笔记" scheme="https://ephen.me/categories/MyWork/"/>
    
    
    <category term="域名" scheme="https://ephen.me/tags/domain/"/>
    
    <category term="网站" scheme="https://ephen.me/tags/website/"/>
    
    <category term="负载均衡器" scheme="https://ephen.me/tags/lb/"/>
    
    <category term="VPC" scheme="https://ephen.me/tags/VPC/"/>
    
    <category term="VirtualHost" scheme="https://ephen.me/tags/VirtualHost/"/>
    
    <category term="LB" scheme="https://ephen.me/tags/LB/"/>
    
  </entry>
  
  <entry>
    <title>关于云平台用户鉴权管理（ IAM ）的一些总结和思考</title>
    <link href="https://ephen.me/2018/cloudplatform-iam/"/>
    <id>https://ephen.me/2018/cloudplatform-iam/</id>
    <published>2018-05-09T16:00:00.000Z</published>
    <updated>2023-05-25T05:59:13.026Z</updated>
    
    <content type="html"><![CDATA[<p>AWS 作为云计算行业鼻祖，不论是什么功能，都做得非常完备，且一切可编程。它们能全方位的解决客户的各种问题，甚至想他人之未曾想，真的非常值得业内人士及机构尊敬。</p><p>但，完备的背后离不开大量的人力支持，又因为它的完备使得各业务都极其复杂。我最近才开始好好看一看 AWS ，才知道居然都有专门的 AWS 咨询师这样的职业。真是厉害了~</p><p>目前主要在看的模块是 IAM 以及周边功能，由于本喵的英文水平不太好，云计算行业术语又了解得太少，看得好费劲。不过通过借助谷歌翻译、上手操作以及咨询<a href="https://u.sb/">兽兽</a>等大咖，也算是了解了个大概。</p><span id="more"></span><hr><h2 id="IAM-非官方简介"><a href="#IAM-非官方简介" class="headerlink" title="IAM 非官方简介"></a>IAM 非官方简介</h2><p>IAM ，全称 Identity and Access Management ，字面意思就是识别用户身份和接入控制的管理，所以我将其翻译为“用户鉴权”。</p><p>整个 IAM 体系主要包括“谁可以使用我的资源”（who）、“如何使用我的资源”（how）和“对资源的使用程度”（Authority）三大方面。</p><p>既然都是和“我的资源”相关，所以我在理解时通常将 IAM 与“资源协作”业务场景结合起来看。</p><h3 id="账户、用户及角色（Who）"><a href="#账户、用户及角色（Who）" class="headerlink" title="账户、用户及角色（Who）"></a>账户、用户及角色（Who）</h3><p>姑且将“我”认为是账户实体，也就是对应 AWS 中的根帐户（Root）。“我”是金主，付钱买了一大堆资源，但是“我”一个人管理不过来，就派人来帮“我”分门别类的管理它们。</p><p>而“我”又不可能把自己的账号密码都公开给这些人，因为“我”的账号密码直接代表了整个系统的经济命脉和大佬权限。所以，“我”给他们每个人创建基于“我”的子账号，称之为用户。</p><p>既然是分散管理，那么就会对这些用户有不同的类别，就好比 A、B 是开发人员，C、D 是产品经理，各类人群关注点不同，于是给用户创建不同的分组。</p><p>然而，可以访问资源的，不仅仅是人，也可能是其他资源、外部应用，或者其他的根。于是，这些被统称为“角色”。</p><p>简单的用一个关系图来展示下：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426155745.png" alt="IAM who"></p><h3 id="接入方式（How）"><a href="#接入方式（How）" class="headerlink" title="接入方式（How）"></a>接入方式（How）</h3><p>用户可以控制台登陆，可以用私有 API 封装到程序连结，亦可以通过 CLI 命令行方式登陆，这个登陆相当于永久性密钥。</p><p>而对于各类不同的角色，它们会直接具备某些资源的访问及操作权限。那么每个资源可能需要开通接口，以提供给不同的角色做临时访问鉴权。</p><p>于是构成了云平台的接入体系。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426155850.png" alt="IAM How"></p><h3 id="权限（Authority）"><a href="#权限（Authority）" class="headerlink" title="权限（Authority）"></a>权限（Authority）</h3><p>可以说，权限是整个 IAM 的核心，控制着这个账户下所有的用户及角色对其资源的访问程度。允许还是拒绝？可访问？可管理？增删改查……对象是某个资源 or 某一类资源？</p><p>在 AWS 中，所有可能的权限都事先设计好，只需要绑定到用户、组或者角色就可以生效了。这些设计好的权限被称之为策略（Policy）。</p><p>AWS IAM 内置了一系列的 Policy ，已足够客户使用。万一不够，还可以创建属于自己的 Policy 。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426155920.png" alt="IAM Authority"><font size=1>（该图片系转载，侵删致歉。来源：<a href="https://www.jianshu.com/p/9ac6f557dd97"> Alchemist - AWS IAM 学习总结 </a>）</font></p><hr><h2 id="不同平台用户管理机制对比"><a href="#不同平台用户管理机制对比" class="headerlink" title="不同平台用户管理机制对比"></a>不同平台用户管理机制对比</h2><p>目前几乎所有的云平台都有基于资源协作的用户权限管理体系，国内的大厂像阿里云、腾讯云基本就是精简版的 AWS IAM ，而国外的产品倒是各有各的特色。</p><h3 id="Google-Cloud-Platform"><a href="#Google-Cloud-Platform" class="headerlink" title="Google Cloud Platform"></a>Google Cloud Platform</h3><p>GCP 在用户添加时便为其设定具备某种权限的角色，当然后期可编辑和更改。</p><p>角色即代表了权限 Map ，一个用户可以有多种角色，而角色策略本身内置不可编辑。</p><p>其他资源或应用需要接入时在第一次接入时自动创建基于 IAM 的成员，这样看来，应用获取的可能也是永久接入权限。</p><p>配置相对简单，但可扩展性一般。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426160008.png" alt="GCP IAM"></p><h3 id="Azure"><a href="#Azure" class="headerlink" title="Azure"></a>Azure</h3><p>Azure 将客户按订阅方式划分不同的套餐，在每个订阅中配置用户角色和用户组。</p><p>和 GCP 类似，有一系列的资源控制内置权限。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426160029.png" alt="Azure"></p><p>值得一提的是，Azure 还有 Win Server 中的那套 Active Directory （活动目录）类似机制，使用域控制器将用户分域、分组并针对应用、控件、设备等（而非系统中的云资源）做一些安全权限配置。</p><p>但关于 Azure AD 我暂时理解得不够，未来可能还需要多花时间研究一下。</p><h3 id="IBM-Cloud-（BlueMix）"><a href="#IBM-Cloud-（BlueMix）" class="headerlink" title="IBM Cloud （BlueMix）"></a>IBM Cloud （BlueMix）</h3><p>BlueMix 在访问管理上看起来并没有使用统一的认证接口，它为资源创建服务标识以提供给内部其他资源或外部应用接入，同时亦可类似 GCP 那样直接为用户和组授权，也有直接为内部资源之间创建连结权限。</p><p>用户是邀请其他账号过来参与本账户的资源协作，没有子账号，不支持权限策略的编辑和制定。</p><p>不过，在其用户的管理配置界面，有提到“未来支持 IAM ”字样。</p><p>看来 AWS 行业鼻祖的地位影响还是很大的。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426160053.png" alt="BlueMix"></p><p>BlueMix 给人的感觉，虽然除了子账号，其他各功能也都有，就是比较凌乱，没有统一管控起来。</p><hr><h2 id="基于-AWS-IAM-的一些思考"><a href="#基于-AWS-IAM-的一些思考" class="headerlink" title="基于 AWS IAM 的一些思考"></a>基于 AWS IAM 的一些思考</h2><h3 id="用户模型"><a href="#用户模型" class="headerlink" title="用户模型"></a>用户模型</h3><p>账户安全问题不容小觑，AWS 在 IAM 控制台首页就提示客户删除根密钥创建 IAM 管理员账户是最佳实践。</p><p>在 AWS IAM 用户管理体系中，它似乎与类 UNIX 操作系统的账户体系有着异曲同工之妙：只有 Root 掌握着最高权限，不同的类别服务使用各自的权限用户及用户组。</p><p>AWS 这样做，可以很好的防止账单信息被篡改、权限配置的错乱等各种安全和意外问题。</p><p>它把整个体系其实上升到了组织的结构，Root 不再是一个人，仅仅是代表了最高权限的集合，只有 IAM 子账号才是实实在在干活儿的人。就类似公司 or 企业，广大员工等价于这里的用户，Root 对应的就是公司。</p><h3 id="权限策略"><a href="#权限策略" class="headerlink" title="权限策略"></a>权限策略</h3><p>个人认为 AWS IAM 最厉害之处就是将 Policy 封装成了统一的框架，并提供了界面配置和适应专业人士的 json 配置模式，从而直接就形成了 AWS 的自有标准。</p><p>同时其内置策略特别多，想必已足够绝大部分用户的使用了。</p><h3 id="资源标识符-ARN"><a href="#资源标识符-ARN" class="headerlink" title="资源标识符 ARN"></a>资源标识符 ARN</h3><p>前面提到 BlueMix 有让用户为服务创建标识，而 AWS 中默认就是任何资源都有其标识。哪怕是一条服务策略、一个操作、一条配置也有自己的 ARN 。</p><p>所以在 AWS ，并不存在 BlueMix 中的那种为了建立连结而再给资源创建标识的需要。底层直接通过 ARN 连接就好。</p><hr><h2 id="关于-AWS-IAM-的周边功能体验"><a href="#关于-AWS-IAM-的周边功能体验" class="headerlink" title="关于 AWS IAM 的周边功能体验"></a>关于 AWS IAM 的周边功能体验</h2><h3 id="Organization"><a href="#Organization" class="headerlink" title="Organization"></a>Organization</h3><p>Organization ，其实就是一个基于树形结构的组织架构图的管理，里面也有涵盖了账户策略。不同的是，Organization 中的账户都是 Root 账户身份。</p><p>一开始，因为看到 IAM 用户组的存在，让人感觉有点晕头转向的，不知道作用如何。</p><p>经过一段时间的试用，我想，该功能大约是用于那种集团公司大架构下的管理吧。有很多很多子公司的存在，相互之间要独立又要有关联。</p><p>而 Organization 最大的作用大概就在于账单的合并与分离，其实跟接入权限控制关系不大。</p><p>有意思的是，在创建了 Organization 之后，IAM 会自动给这个 Organization 创建角色，从而在 Org 内部的用户可以通过 IAM 角色切换登陆。</p><h3 id="Cognito"><a href="#Cognito" class="headerlink" title="Cognito"></a>Cognito</h3><p>Cognito 是一个应用程序管理器，为你在 AWS 中创建的应用程序管理各种不同接入权限的用户池。</p><p>其实它跟 IAM 并没有什么特别的关系，IAM 是基于平台系统层次的，Cognito 基于某个具体的应用程序。假设 AWS 也有类似 ISO 网络模型的话，它们就不是同一层的概念了。</p><p>尽管我是偶然发现的这个模块功能，可其实在 Cognito 创建用户池的时候，发现它也会同步的创建一系列 IAM 管理角色。看起来，在应用程序的接入控制上，可能也调用了 IAM 体系中的某模块。</p><h3 id="CodeStar"><a href="#CodeStar" class="headerlink" title="CodeStar"></a>CodeStar</h3><p>CodeStar 在 AWS 中官方中文版译作“项目”，最先我也以为是以一种资源集合的形式存在（类似 GCP 的 Project ），实际看了之后也并不是。</p><p>CodeStar 其实是一个开发者平台，将开发者的项目直接发布到云。可通过连结本地 IDE （比如 VS Code）、代码共享平台（比如 GitHub）一站式管理和发布开发中的项目。当然 AWS 也提供自己的 IDE 和 代码共享平台并在这里推荐用户使用它们。</p><p>这样看来， CodeStar 其实类似一个多语言多平台的 GitHub Page 了，因而不仅仅是 Page 。</p><p>同样的， CodeStar 的创建也会向 IAM 中添加相应的各种角色。</p><p>其实在 AWS 中，真正的资源集合是顶栏标签上的“资源组”，虽然一贯的 AWS 风格，反倒资源组并没有惊艳到我，没有比较深入的体现协作管理关系。这点，我个人还是更喜欢 GCP 的项目风格。</p><h3 id="……"><a href="#……" class="headerlink" title="……"></a>……</h3><p>其实上面那些严格来说也不算是 IAM 的周边功能吧。 AWS IAM 管理是全局的，很多功能模块使用时可能都会去创建个 IAM 角色接入到管理系统，以辅助完成该模块的身份认证和鉴权。</p><p>从这些试用中，可以发现 ARN 中的 “ Resource ” 一词，在整个体系中已不再是狭义的主机、数据库等用户申请创建的虚拟或硬件资源，而是平台中的每一个的功能包括账户管理、应用管理甚至 IAM 管理本身。</p><hr><h2 id="一点题外话"><a href="#一点题外话" class="headerlink" title="一点题外话"></a>一点题外话</h2><p>在看 IAM 这块内容时，不禁让我想起了多年前我在湖北省电信工作时的 BOSS 三户模型。那个体系因为业务的关系，比这个更复杂，在开发和实施过程中也是研究出了大量的通信标准。</p><p>印象中，那种完善的协议制定往往是多个专家经过了长达几个月的封闭式细节推敲和研究才完成，并且有着层层的质量审查。在我国互联网快速迭代的今天，这些真的是太难做到了。</p><p>而 AWS 一直坚持的标准和框架结构，想必在形成和迭代的过程中也是非常精密的。</p><p>技术复制可能容易，但精神和思想不易。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;AWS 作为云计算行业鼻祖，不论是什么功能，都做得非常完备，且一切可编程。它们能全方位的解决客户的各种问题，甚至想他人之未曾想，真的非常值得业内人士及机构尊敬。&lt;/p&gt;
&lt;p&gt;但，完备的背后离不开大量的人力支持，又因为它的完备使得各业务都极其复杂。我最近才开始好好看一看 AWS ，才知道居然都有专门的 AWS 咨询师这样的职业。真是厉害了~&lt;/p&gt;
&lt;p&gt;目前主要在看的模块是 IAM 以及周边功能，由于本喵的英文水平不太好，云计算行业术语又了解得太少，看得好费劲。不过通过借助谷歌翻译、上手操作以及咨询&lt;a href=&quot;https://u.sb/&quot;&gt;兽兽&lt;/a&gt;等大咖，也算是了解了个大概。&lt;/p&gt;</summary>
    
    
    
    <category term="心情驿站" scheme="https://ephen.me/categories/emo/"/>
    
    <category term="工作笔记" scheme="https://ephen.me/categories/MyWork/"/>
    
    
    <category term="用户鉴权" scheme="https://ephen.me/tags/user-auth/"/>
    
    <category term="IAM" scheme="https://ephen.me/tags/IAM/"/>
    
    <category term="资源协作" scheme="https://ephen.me/tags/co-work/"/>
    
    <category term="AWS" scheme="https://ephen.me/tags/AWS/"/>
    
    <category term="Azure" scheme="https://ephen.me/tags/Azure/"/>
    
    <category term="GCP" scheme="https://ephen.me/tags/GCP/"/>
    
    <category term="BlueMix" scheme="https://ephen.me/tags/BlueMix/"/>
    
  </entry>
  
  <entry>
    <title>记生平第一次手术经历</title>
    <link href="https://ephen.me/2018/First-Surgery/"/>
    <id>https://ephen.me/2018/First-Surgery/</id>
    <published>2018-03-27T16:00:00.000Z</published>
    <updated>2022-02-22T06:04:31.553Z</updated>
    
    <content type="html"><![CDATA[<p><strong>各位看官请注意：</strong></p><p><strong>此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。</strong></p><span id="more"></span><hr><p>2018 年春节来得比以往晚了很多。这一年的春天第一次尝试自己在家做腊鱼腊肉和腊肠，做得很成功，吃得也很开心。</p><p>于是埋下了一颗意外的种子。</p><hr><p>正月初四的晚上，正开心的用餐呢，突然被鱼刺卡到喉咙。可能因为刺比较短小，感觉时疼时不疼的，我咳嗽和呕吐都弄不出，想着可能只是划伤了而已，无碍。</p><p>随后的几天也一直都是时疼时不疼的状态，自我感觉有好转的迹象，竟安慰自己大概是身体免疫力下降了才拖了那么久吧。</p><p>春节假期休毕照常回公司上班，不知道是从第几天开始竟然觉得喉咙刺疼得厉害难忍，遂下定决心周末去医院看看。（侧面反应我真的是一个严重拖延症患者，死到临头了还想再拖几天）</p><hr><p>周末上医院，医生拿灯照着并压住我的舌头简单看了下，并没有看到鱼刺。心里一阵窃喜，想来估计是没有吧，以后可要好好锻炼提高自身免疫力。</p><p>谁曾想，医生出其不意的给我开了个单子，让我去缴费，说需要做喉镜看看。</p><p>口腔和鼻子被喷了麻醉后躺手术台，医生拿着一根长长的管子过来，我赶紧张大了嘴巴，竟然将管子从我鼻孔中伸进去了。。（枉我这么配合的做好准备……</p><p>果然发现了鱼刺，同时医生赶紧叫来家属，说我急需住院手术。</p><p>会厌舌面长了多个菜花样的囊肿，需要切除，拖久了会影响呼吸。</p><p>于是当天就匆匆忙忙办理住院，签各种知情同意书预约了次日手术，接着就是做各种术前检查，买生活用品啥的忙一整天。</p><hr><p>其实只是个小手术而已，但还是搞得我特别紧张。</p><p>由于周五下班大雨电动车没有骑回家，周日一早就赶紧让老公去公司把车骑回来。</p><p>结果独自一人在医院打着术前点滴，看着身边的人都有人陪护帮病人忙出忙进，心里竟感觉一阵酸楚，又赶紧打电话让老公回来。</p><p>其实医院的环境还是真的很能影响情绪的，到我要进手术室的时候护士问陪同家属在哪，我打他电话一直都没有人接，忍不住哭了起来。</p><p>直到等他匆匆忙忙赶到手术室门口，我说了婚后的第一次“离婚”。（听说每个人婚后都会有几百次想离婚的念头，我这个算吗？</p><hr><p>进手术室，心电监护、打针、吸麻醉剂，一下子就毫无意识了，直到手术完毕被医生拍醒。</p><p>我依稀记得入睡前，打完麻醉没一会儿就听见监护仪的报警声，显示“呼吸暂停”，硕大的红字。我很害怕，拼命的想呼吸却影响不了仪器上的显示。</p><p>而后又听到了另一种急促的报警声，但是再也没有力气偏头看仪器了，甚至觉得自己就这么死掉了。</p><p>医生拍醒我的时候，让我千万不要闭眼睛睡觉，但是那眼皮似乎有千斤重。直到自己慢慢清醒，这才有种劫后余生的感觉，如释重负。</p><hr><p>挺搞笑的是，术前因为家属一直没到，胡思乱想到哭着睡着。</p><p>医生说做手术的时候没哭了，但是一醒来，那眼泪又吧嗒吧嗒的自己往下掉。</p><p>其实刚醒来的时候，我自己还是没有什么意识的，感觉不太可能是我自己突然要哭，我估计大概是接着术前的眼泪流下来的吧。</p><p>有点意思。</p><hr><p>果然是个小手术，术后休息了一天打了一天针就基本生龙活虎了，周二敬业的我戴着留置针去公司上班。</p><p>然后按时吃药打针，直到一周后复查出院。</p><p>挺不错的，除了喉咙里面感觉像有个小椰果堵着，再没什么其他不适。</p><hr><p>这场手术，最大的收获就是体验了全麻，让我想到了很多。</p><p>麻醉真的会有意外的，感觉自己真的还没活够，特别特别害怕意外。</p><p>原本从去年年底到过年的时候，感觉心理毫无由来的特别抑郁，手术过后莫名没了，虽然不排除气候原因；</p><p>原本自己扣扣索索的不愿意出去旅游花钱，打算把婚假留着盯装修的，当晚就在途牛上下了订单；</p><p>原本觉得自己就安安心心待公司打酱油，却下决心了一定要找工作机会；</p><p>我开玩笑的对自己说：如果不拼搏，我拿什么证明自己存在过？</p><hr><p>一切尘埃落定，最重要的，保持身体健康，再来实现自己的存在。</p><p>春天到了，该锻炼了哦~</p><hr><p><strong>未经允许，不得传播此文中图片及任何个人信息。</strong></p><p><strong>情节严重者，将追究其法律责任。</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;各位看官请注意：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="心情驿站" scheme="https://ephen.me/categories/emo/"/>
    
    
  </entry>
  
  <entry>
    <title>VSCode 中使用 PlantUML 插件生成 UML</title>
    <link href="https://ephen.me/2017/VSCode_PlantUML/"/>
    <id>https://ephen.me/2017/VSCode_PlantUML/</id>
    <published>2017-10-22T16:00:00.000Z</published>
    <updated>2023-05-25T06:04:40.600Z</updated>
    
    <content type="html"><![CDATA[<p>作为一个伪技术人员，灰姑娘用的 IDE 大概是不那么流行的 <a href="https://code.visualstudio.com/">VSCode</a>。全称 Visual Studio Code ，微软家近两年才推出来的一个产品。</p><p>这个 IDE 的整个软件界面以及使用都和 <a href="https://atom.io/">Atom</a> 非常相像，它本身比较轻量，但又可以安装很多扩展插件以满足使用者的需要。虽然对过去使用老古董 <a href="https://www.ultraedit.com/">Ultra Edit</a> 的我来说，刚上手着实有些不习惯，但是用久了之后还是觉得不错的。（尽管我用 IDE 的频率不高。。</p><p>最近，同事希望我给 DNS 解析流程画个 UML 图，并推荐了一个通过脚本语言生成 UML 图的开源项目： <a href="http://plantuml.com/">PlantUML</a> 。</p><p>上网搜索后发现，可以不需要下载这个项目的 APP ，很多编辑器都有它的插件。但是我翻了好久，并没有看到基于 VSCode 的实际应用示例。</p><p>我在 VSCode 上搜到这个扩展插件之后，环境部署还很折腾了一会儿。遂将一些经验在此分享给大家，希望能对其他路过的人有所帮助。</p><span id="more"></span><h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>PlantUML 本身只是一个脚本语言，如果要生成图片，是基于 <a href="http://www.graphviz.org/">GraphViz</a> 绘图的。而 GraphViz 又是基于 dot 脚本生成图片，它依赖于 Java 和 Dot 脚本环境的配置。</p><p>所以，使用 PlantUML 有如下基本环境要求：</p><h3 id="1-安装-Java-环境"><a href="#1-安装-Java-环境" class="headerlink" title="1.安装 Java 环境"></a>1.安装 Java 环境</h3><p>上官网下载后安装：<a href="https://www.java.com/zh_CN/">https://www.java.com/zh_CN/</a></p><p>注意配置 <code>$JAVA_HOME</code> 环境变量。</p><p>配置完毕后启动 Windows Shell 执行 <code>java -showversion</code> 命令查看 Java 版本，以确定 Java 环境是否准备成功。</p><h3 id="2-安装-GraphViz-程序"><a href="#2-安装-GraphViz-程序" class="headerlink" title="2.安装 GraphViz 程序"></a>2.安装 GraphViz 程序</h3><p>下载地址：<a href="http://www.graphviz.org/Download_windows.php">http://www.graphviz.org/Download_windows.php</a></p><p>下载安装完后（灰姑娘将其安装到了 D 盘路径：<code>D:/program files/Graphviz/</code>下），也要配置环境变量。</p><p>将 GraphViz 可执行程序路径配置到 <code>$path</code>：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426152846.png" alt="GraphViz 环境变量"></p><p><strong>后面的所有配置（ dot 配置和 VSCode 插件配置）都是基于 GraphViz 的安装路径，需要参照的小伙伴请注意。</strong></p><h3 id="3-配置-Dot-脚本环境"><a href="#3-配置-Dot-脚本环境" class="headerlink" title="3.配置 Dot 脚本环境"></a>3.配置 Dot 脚本环境</h3><p>添加环境变量 <code>$GRAPHVIZ_DOT</code>。如下图所示：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426152918.png" alt="Dot 环境变量"></p><p>配置完毕后启动 Windows Shell 执行 <code>dot -v</code> 命令查看 Dot 版本，以确定 GraphViz 和 Dot 环境是否准备成功。</p><h3 id="4-安装-VSCode-插件并配置"><a href="#4-安装-VSCode-插件并配置" class="headerlink" title="4.安装 VSCode 插件并配置"></a>4.安装 VSCode 插件并配置</h3><p>VSCode 需要安装两个插件： <code>PlantUML</code> 和  <code>Graphviz Preview</code></p><p>打开 VSCode 切换到左侧扩展商店，搜索并安装他们，安装完毕后分别激活。</p><p>点击 VSCode 左下角齿轮按钮进入设置，在用户设置脚本中添加 <code>&quot;graphviz-preview.dotPath&quot;: &quot;D:/program files/Graphviz/bin/dot.exe&quot;</code> 并保存设置：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426152953.png" alt="graphviz-preview.dotPath"></p><h3 id="5-环境配置测试"><a href="#5-环境配置测试" class="headerlink" title="5.环境配置测试"></a>5.环境配置测试</h3><p><strong>重启 VSCode 。</strong></p><p>新建文档输入以下测试代码：</p><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line"></span><br><span class="line">[*] --&gt; State1</span><br><span class="line">State1 --&gt; [*]</span><br><span class="line">State1 : this is a string</span><br><span class="line">State1 : this is another string</span><br><span class="line"></span><br><span class="line">State1 -&gt; State2</span><br><span class="line">State2 --&gt; [*]</span><br><span class="line"></span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><p>同时按下 <code>Alt</code> 键和字母 <code>D</code> 键，预览生成的 UML 状态图。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426153029.png" alt="PlantUML 测试"></p><p>如果出现如图所示的错误，检查下是不是前面 GraphViz 安装和配置没做好。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426153134.png" alt="GraphViz 报错"></p><h2 id="分享：-DNS-解析流程图"><a href="#分享：-DNS-解析流程图" class="headerlink" title="分享： DNS 解析流程图"></a>分享： DNS 解析流程图</h2><p>为了画这个图，灰姑娘专门去学了下这个脚本语言。如果小伙伴们也想学习，官方中文指导手册在这里：<a href="http://translate.plantuml.com/zh/PlantUML_Language_Reference_Guide_ZH.pdf">点击下载</a>。除此之外，<a href="http://www.jianshu.com/p/e92a52770832">这里</a> 还有网友分享的快速入门教程。</p><p>回到正题，我的目的是要画个 DNS 解析流程图。</p><p>最后图是勉强画出来了，看看画得咋样？</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426153216.png" alt="DNS 解析流程图"></p><p>上图源代码分享如下：</p><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">@startuml</span><br><span class="line">title 域名解析流程图</span><br><span class="line">skinparam <span class="keyword">state</span> &#123;</span><br><span class="line">  StartColor MediumBlue</span><br><span class="line">  EndColor Red</span><br><span class="line">  BorderColor Gray</span><br><span class="line">  ArrowColor Gray</span><br><span class="line">  ArrowFontColor Indigo</span><br><span class="line">  BackgroundColor&lt;&lt;Request&gt;&gt; AliceBlue</span><br><span class="line">  BackgroundColor&lt;&lt;Answer&gt;&gt; HotPink</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">state</span> UserClient &#123;</span><br><span class="line">    [*] --&gt; 请求访问域名</span><br><span class="line">    请求访问域名 --&gt; 本机host</span><br><span class="line">    本机host -right-&gt; 成功访问域名 : 有映射</span><br><span class="line">    本机host --&gt; 本机DNS解析器 : 没有映射</span><br><span class="line">    本机DNS解析器 -up-&gt; 成功访问域名 : 有缓存</span><br><span class="line">    成功访问域名 --&gt; 本机DNS解析器 : 缓存更新</span><br><span class="line">    本机DNS解析器 --&gt; [*]</span><br><span class="line">    note left : 本图展示正常解析流程\n未成功访问域名不能结束\n（最左支路径无效）</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">state</span> 请求访问域名 : ephen.me.</span><br><span class="line">    <span class="keyword">state</span> 请求访问域名&lt;&lt;Request&gt;&gt;</span><br><span class="line">    <span class="keyword">state</span> 本机host : Windows 目录：</span><br><span class="line">    <span class="keyword">state</span> 本机host : C:\Windows\System32\drivers\etc</span><br><span class="line">    <span class="keyword">state</span> 成功访问域名 : ephen.me.</span><br><span class="line">    <span class="keyword">state</span> 成功访问域名&lt;&lt;Answer&gt;&gt;</span><br><span class="line">    <span class="keyword">state</span> 本机DNS解析器 : Windows 查看命令：</span><br><span class="line">    <span class="keyword">state</span> 本机DNS解析器 : ipconfig /displaydns</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">state</span> DNSServer &#123;</span><br><span class="line">    本机DNS解析器 -right-&gt; 本地DNS : 没有缓存</span><br><span class="line">    本地DNS -right-&gt; 根域名服务器 : 没有解析</span><br><span class="line">    本地DNS -left-&gt; 成功访问域名 : 有解析</span><br><span class="line">    根域名服务器 --&gt; 顶级域名服务器</span><br><span class="line">    顶级域名服务器 --&gt; 域名服务器</span><br><span class="line">    域名服务器 --&gt; 本地DNS : 获取结果并缓存</span><br><span class="line"></span><br><span class="line">    <span class="keyword">state</span> 本地DNS : 用户配置（<span class="number">8.8</span>.<span class="number">8.8</span>）</span><br><span class="line">    <span class="keyword">state</span> 根域名服务器 : a.root-servers.net.</span><br><span class="line">    <span class="keyword">state</span> 根域名服务器 : b.root-servers.net.</span><br><span class="line">    <span class="keyword">state</span> 根域名服务器 : ...</span><br><span class="line">    <span class="keyword">state</span> 根域名服务器 : m.root-servers.net.</span><br><span class="line">    <span class="keyword">state</span> 顶级域名服务器 : a<span class="number">0</span>.nic.me.</span><br><span class="line">    <span class="keyword">state</span> 顶级域名服务器 : b<span class="number">0</span>.nic.me.</span><br><span class="line">    <span class="keyword">state</span> 顶级域名服务器 : ...</span><br><span class="line">    <span class="keyword">state</span> 域名服务器 : lv3ns1.ffdns.net.</span><br><span class="line">    <span class="keyword">state</span> 域名服务器 : lv3ns2.ffdns.net.</span><br><span class="line">    <span class="keyword">state</span> 域名服务器 : lv3ns3.ffdns.net.</span><br><span class="line">    <span class="keyword">state</span> 域名服务器 : lv3ns4.ffdns.net.</span><br><span class="line">&#125;</span><br><span class="line">@enduml</span><br></pre></td></tr></table></figure><p>希望我的分享能对路过这儿的你能有所帮助。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;作为一个伪技术人员，灰姑娘用的 IDE 大概是不那么流行的 &lt;a href=&quot;https://code.visualstudio.com/&quot;&gt;VSCode&lt;/a&gt;。全称 Visual Studio Code ，微软家近两年才推出来的一个产品。&lt;/p&gt;
&lt;p&gt;这个 IDE 的整个软件界面以及使用都和 &lt;a href=&quot;https://atom.io/&quot;&gt;Atom&lt;/a&gt; 非常相像，它本身比较轻量，但又可以安装很多扩展插件以满足使用者的需要。虽然对过去使用老古董 &lt;a href=&quot;https://www.ultraedit.com/&quot;&gt;Ultra Edit&lt;/a&gt; 的我来说，刚上手着实有些不习惯，但是用久了之后还是觉得不错的。（尽管我用 IDE 的频率不高。。&lt;/p&gt;
&lt;p&gt;最近，同事希望我给 DNS 解析流程画个 UML 图，并推荐了一个通过脚本语言生成 UML 图的开源项目： &lt;a href=&quot;http://plantuml.com/&quot;&gt;PlantUML&lt;/a&gt; 。&lt;/p&gt;
&lt;p&gt;上网搜索后发现，可以不需要下载这个项目的 APP ，很多编辑器都有它的插件。但是我翻了好久，并没有看到基于 VSCode 的实际应用示例。&lt;/p&gt;
&lt;p&gt;我在 VSCode 上搜到这个扩展插件之后，环境部署还很折腾了一会儿。遂将一些经验在此分享给大家，希望能对其他路过的人有所帮助。&lt;/p&gt;</summary>
    
    
    
    <category term="工具介绍" scheme="https://ephen.me/categories/tools/"/>
    
    
    <category term="VSCode" scheme="https://ephen.me/tags/VSCode/"/>
    
    <category term="UML" scheme="https://ephen.me/tags/UML/"/>
    
    <category term="解析流程" scheme="https://ephen.me/tags/parsing-process/"/>
    
  </entry>
  
  <entry>
    <title>告别“牙套妹”称号</title>
    <link href="https://ephen.me/2017/Goodbye-Orthodontic/"/>
    <id>https://ephen.me/2017/Goodbye-Orthodontic/</id>
    <published>2017-08-28T16:00:00.000Z</published>
    <updated>2023-05-25T05:54:48.148Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，这个密码看着不太对，请再试试。" data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="cb5171b26b4975e64b2ab1e6b25766e2fc48e602c0fe253ad2c806886f61105d">0ee3cb304de3f3eeb2822069940fc1dc8e86914065a8c590fa83e801755519e76341f8ac311c14eb31d38807f36af5edb1e96150b3c63827e6beaa2523cb9187c21a7b6878c4c482037b356b3ac0ad5897bef34bb7be6905715abef1434b77e9121957855a502985c3d4e19ece0736209259b66321d780bf66d47c27cc6598fcb51a92a52409e58d3ab255e97a44772690a2a2f8e8d9dd3faa3ec1e9fa963edb794e0dea1390cdc54ff2247ec23344664c8afdcd1fc83056ead5f492c54bf6342c50930e11150eccea5373254a93dd0f45298453e17afe803cc4049e36dff34bdd5c8a6f72daf3db0fd7bba169ffa0d5ce71747295abb049d397811cd74022c5c0994a059b5a7ec59422102e4f86cc2e752ca1e8772c77afaeb9e92e2615e2965c4dde0631a5e68532b538b2e72c084904ea007dcaebddcde33623d6ec793f3ba39058e4726ee77deb255f2d98733680e159f87aca8d12f071391304e5cbd960ff48f162134a03c0cc84638329ee21bdbbb192befef0dfc9301f5f283751ef3271a43c6047de4bb1b104699f5b344cc57d9e8bd49bdf63b81fcfdaa282796a42f04df321a0bb977e31977a845cac3cccaeb6de91c84bfc5a470b945b42b785bee1ae30b6638d5e32703847783db52543a6d7d7d1c1262ac56943dbc8dbf361030ccffc65026d5b5b2f3a3d3ca1eaaad41cbf210c968edb4194b3eaa3578d5ab1919c67987c145eea9265782ce419f31f659e170eee5d9fc645cc01ea9252ad91813e349839a580b97acf0989a51a514a772020f53636e0de7f10cc0f327148ba0bd12f77be2997710979054af112da509e385bbc371443179fcdd7c2b40dd809fd6aa6896899b0d18c1655e998b478c7641119b3b1e7c20645239b7e7a095196a095797c3187e80369c369417c4ca55aabef284531c731a562413b252e9e54657f0907d564a723f47075802a63845f5ae1aceacce616d11452135609c8deb6ac575475608a93d6abf734de933dfeb8269fcd946cdf00decc02878f4b82ebdf5a5cc2eada07d536f80e27b909e2327ca1775deeae4fbdf37256432c217571478acb03e693aa87aab20b707aa6048b56af768c42dcfd5303bda991a09958c6293ecbe57999804f4aa43ede035d90e5fe991a3453fb049688ece5633eae1744b51fd29d24cd6c76f8de2cae0785e093f723012f4043a32bd794204387ecfef714dcc85f8033b8d4263ccbc9458a392671b008b3bfdb6de46f8318957dab3b0ff6e8775567f4de8289ee98313cc42110e1d9105d7d88c203d73be1586d5b2f37d4ef5093663a65a6cfadfa8876a7dcd1bf16de91c9cb3ecd7b53804c8575c3b053d911bf59fc2dd1033ac444d28b4f724f54210dec7d5b8556c3595163fc326bd5bc5e6a92c019c183d6971184fbdd27ea0310ab7b7f7db44e865c01a87f465258daac335af8a0cc7b03bb296498b7dce7e3c79e48c1222a3157e2bca891eaab451ffef537856a26ad9466a5a5227d4d908431b8b88ca829531edfa7e7f6b5e22903b5a0e4e458dcbb320f37f9d699080008855c6c131ddcd0e0c699bcc0d58acbcbfccd7ffdfb216cf63343f75e35a3f6447e5427a9d419a0e556ce1efa286bf1f486ea79b93b05715d5d179122956ffb345c3554f6098750dad9c6eb59745727afdf00cccebc9adee3b1afcb3debc650c4ee0bb5e5f4026381af10b94f016f8df649036531a5e609b7bcab9708e8e153387575fb4c92dd0bcc2437ebc61dacf821dfbce5b09265a6d4791cefb5b5c54c08df9ca5fb047ab82ae5d9abbc9d432e3af0d63b12deac1f0808f5d069dea7b2981569d2ef4409e20545d85bd5cc933ca1558a0a5dd8cfd9ea894bafc2f8566674b9783c0a77f5ed02e3ec7393ecaf25d329936cd468029d19007213afffcc51bd289f50af743121eabbd8675ed197dc7812044257dd7aec2cb220d5da46eff144564b42288be8bc4842e9c698b98194e5e07ca1bf4ad180500f0285105c8680691baf6bb99e8cd8b4623fe466ee7c04aca27e5fe10ab790eb4ec808d56828bc2f9fa79e4c32cb96a13874d8702cf223f12a7dd89cede2b729ef28b712b8abb89359733b28ec02dcebc139b9a7653a4ce0feee099150225a80a354c5717e09141284eeee6a420af070189fe824ef55817a4d355cc6c915dc6f6924e0b3af87eec92e121e82f68ba7f59b9a763748747d8b6bb4c461802bb4053294c0cb004e5af17c7494e4a6e65d293fb5be92f6832dda2bc5a55508a8e1c072ef29b0eebfb01e762588ab8da3927a1391271f0d7f58c4ee5aa2e77625c696bdd42faacaa02ad38439e4fcd165940b1e4434878fed4c47cb91ebe840dc261193e34dd9a89e8567d2f9e1e699aec8ce79141b533d193a313320a42b2eea37fc082d95cb0fd49709aad4f36562ddb92e7d3cd1f50d9384f70c7039d098d9a28052073a2ae283fd99a83366ddc0cc8f26109869ba3e3b0278e13be580cb06a502a93f548fee1a02cd7d6d5df4f3ef30610cc712886d1fd1d991253e8e98bb266209dfc78516e81c5b263f7eb881742788432f4b9a79f3870f69ac5db8d23eebba49293298be29aa26e7e15d410479c9528c12d1299c79145912fe829dc962ee0bd716e2467a9e32f8952be8a2b4001db6e87d6806abe8c28207508354d810328139f9a9de0b73def3a9a34ff99e254a384f1573d9d37fbc997028a158043edb7b488e4c9da283ea4a04319152e07211e58f71b841b7fee7097e61887c46ce70fbc1b3a8c5f07ed439a129444b4ddee3868ab994d11fa331476e17fc7f6f264d4cd62fc6a1f7d5684c71cb2c5192ec79c792fbc703ce09f13841acf1a050fc4774a421b7ffddc77a1a86cd0abf2263ff374de297253b2bf8ae474fd9960da73f82d5f9634cac79c87b2062ec8891e38e167d5633b5b0cc1d84e2e36a6b1d228387d38e579d4f8b4c1db873d047c0390ab73151e926212657dad85115cde714d703f2345dde96e9e7c5641c83908d8d9c04fda9e64ea7688362be49d4219328dbb206f2b213bd53664cbbf1a6674a034a11b2f619d7d26e2f9030b55e82b7ca040fd532a23e83ab38ccfff3fb9fe787c7f4d89dd45121f6e3bc66b8e06c81a0f26f720f0cec86059bea4a141e7e5b1c95a5b035b1a09d4cef1a1792a9270b85bbf6f2dd14953b39f02f67d4d3e98da8cdb22cb6bf8eaffb74ce9ccfe363fa8422cacb40f91b3e8d96e6e6364d43dfaa9467dd1f5eded0d4249ffe76a2b5a88f9d367f044d56147933f08a149e12db3ed01c75729d3eca688cfb5b2d815ebfef443f828eb9bbf220863114e99c86cc35aefa9f9e87bf971eb17a9f11fa38b407fa70bbe6811999f5e68fad7662cef17066f23b67ee9667a5be3d47dd743351e15ede1c560fecb1e398a929011b535ee6d6607d41818cfc134b3d3c9f6077eeae1bc87ff09731ba41cfd42949ef058a266f7963366288bec39bd5b66c5133e2f47723c03ae3ca3417eaae39df75395ca390b569e21241415c035f77bc7f57fddbf084c69d0ba8f8a4a494e9dc7578e3249af1c8e6779e5e619d2ef05661b14059add389ca736e8e6725a6186ec98d8a0bb942e44eeafdec2278f7d99f1e8c934bcec2d736206164553bfc8fb3b7e2634ea249fceab5a61ed8b9121d953ce097d2483104bd236dd2a849192d8d50b1a8a8ef7fc14de153fe3451beb0a998e4002752a92f066070b5784116f7e2bc35e70c8abce9c77612d288cb3b68a5e2888836cd2b3f3d744be2089344b6ff99067b5f904583b28f3522f2c54c45a3900410aaf2c4f72c8983909a1f0ddf9ade9b28cb1207947744074a9a376f60f62fba3f13ab4b58ab58efa32936ddd82aef1521c444f47355836c506b7295aa477cfc95598981253b0b787abebf0f080e8e671bd1edd922390d2590194772fcbbbf485504d1edfceda0f06214112a0c1f6b3f0a320971c12b5bf3e06caec556493c19f217f096c51decf02eb086d68bd0641acf12760c4f8f536bfdefb8a4e26508e2e650694ef109ca25344a13f6defa7beb436967828b89b2d0ed3e733391cd03445401f19c74724cc2ba904af02637991dfecc7111a2911b1ea0b4ef76fab97e3c50397f40bb7afcd7cc690256bd5d0dcf60273be2211b7aa6a3573d24d2583b403fad2bf6552f71fdce993c79610b3c9de2cd88c000e34b9af391d57807ba72b4e2a097d88d6272efa1434a721db94cca572e75fb42d2f0b4f07ba7fb98024dd42ea2cfea074b8be6108c07fbc207c0fa6aa5c8613fb60e56ce8437ec3d54451c9ec9245b57a3531091810212419aaf463499e79b7191d87f043620aa178f6b20eb32ccb05751248d0a7790faf9aa0e6fc88b507a981afca56245b174948f0f79f972321934ed46816d94ab3d1674aa1873cf116bc3e6cd37b58c104e9a03f903b0c1ab82be83553c3d0443da45f7c52330bbe7048123ec7b2df81d7e4eb3fc4971e9a2e3b60745ab83e8bf0e599c6a4dafebb377bb7455f01d3c6d3ade38b4870b024af88baae21e1fcd026ddd97da7bc422a42defa5973409531a86d82c9102a3dcfee11c9f1f4179c09631a48c2589d755a89573da6ef50e356d5a6ffb996475a3499d08ea8462bc55bde2f07bb8666c2e0f51962cf01f489def18e394ca6bf9eef0e1333f2f52621fafab39355d20464f694c305846ca5ce3c10517e408dc4adbb935bf6f680a73816f016b39855d7c388e0274e52a3a005e5893742b7d1ad66386c604bc17a6d7c695dc912c1a41653d66b07167f52785094535225afc8965c08d1a705ca3086925294319d66697100fd51f0fa1e8c10a78578262d412ffb02cd02274e7f621394e04ffb4cd78f6f26246efcd7452bb4ca67884f26537eb9552a92e66a535fd742ddeb69bbfea5c1f46b77835b7b551d8c2af1bca463f5d55889a7d9871c23beb5be9c56169daf2933a43e99df54fcad878c5996308de36f749b56b5f50a1e1ec5756c55f3b7edd6f2ccabfc61ed6fb07d4e4899e52ead49720ea433496f09a4bac4b95aefc0ba04abcd22cdd6edce3677e384d266e4587fe4e051353451283a15ed43ca3de81ba72461789a5afa47ee3b82f661372a4dcdf1c7505bcf939ed2beed246395585112f47235022a9bb33626ad7c9a3399f04a330f627d5ffc59150ee7ed6e224f7f30b4a5f03c91e68cc35416e0a5c2c105ddd06a3ceea0e7cceddf27568413269877f8b59c511be8af30ace53a0ed52579a2f643a9a9cf8b609dce40b57f9e57f4b15c1d30100c7617c462304cf0b6d4411ac4cf4ff38c56c0ab26ebe9fbea253866b444c08721a54f2d17490002dac6acd28bdfe362e38713a59d80aa93a14796d6633c74127ebe1cc4272a528a56e759e6fcabaf3a4a234d120c9c4427b108176432a3f49a733aea00d1efa496787cdf823016b437b98be1ce39b135926fe62130979657ad2e3f84d0e87eac901366d30b98e46c563e6f8f0caaadb9d75a0342d377de210d4bde3c2ae38e8b5112495207825530883bd143c8ef1e97ec3e40b8ac4b2fb79b496df8f98bbb1db3283d92830c851b6ac6906a4e3e4f4abb461e9361612b9932fa7dd0f068646a00a471308b2338efc0ebe3a1f8d576956c93ba2ca30b2c86e57f9525d2548fe5aa9b8c46448fb9055c99ffe891f0a2f85fdbc8971f072a80cceaf7ed049b9ac8b03bd7561547a1755d1cc6e6d6f59cceb81101c0aa713911167100d65079242c50e6514f1754c9baa0e3963f702a840dd4a380cdfa67230d2dff61c53e4b63ee229bbfbfec74c2bc0832a6db90e1948e1dea8a9985cc399214eb1b74584e8494309885b55b83a4e15debd9423603bc2a860af6941ea0cb18363bda26e289bdd0315923ab448c0f2cb1f6fa04617dfeab335ccbe7421dade119a5f426d71e4655a0bb2095a660d267c166609891faf3b64c751a0cb65c86d68fe2f46ef731d8a1de5d9d8a2a2078bde3050e69d28c564d9bad954198b23495328363918fd930177c2819c5732e4994c96a5cf3a43fec4ec88413b0c289d74d32daa9a5091cc910bb6b698b30045d44e9e3b7d08bd1b71bdc422928342df29c597df935b5c64baa8aaeae8bf69e7f807009b4074775443307357e058efd9ca6f5c020da9295f4dfa20127d09047df32e5872a96bfefa7f6309128d966cf6bccc3d93b1d46e010853cd8d2f9af03379a1804d3c95d9abe4140b8bfd89f6410cdf51af52dbbfe59282494408ae0036c2ac0bd4855489a7727fe6802934810cecb655635b8b35caeff3a295fabf171de9c1e043d8dc96c675aa9b13aa195113cfc4409fe5e79c2924dda86da0fbc3716bcf43885d60e8e7d45f027b8fa257dc4f9f102014998bbe4c2ab66f605a2fc6f4b904588ad53d236c159505d403835e37beb68932aaa1a17fdf6c2c36f4c83ff88dfe20b1ca06dec35d20a088aefe221efb8d75be2b72e416f0c561d1c2b01610f85ff63cc314d7ebe913becc6c9d0b8655c487c5235881b43ecbdd24beed6b7462ba2216a3681a1b3239ed54eff2a0ca4de7445c40044ee3aeeb8e0ce162e6773c0793bb4674ee3439f2b3388a362f80192d9f461c4900c5e90ea51ecb8870a878b9194e44240b355a35c76d269c405e758c81a9fd3b22a2547043017b5a8b25b97acf5ca8253ab28ec3159cafc2b6320b64a62b707346041088795e212e39d2fdec197de4e2d6a0eebeb7f630d4f2693bcc8ab2c607c9e78228fd4fbb43c1c9b1ca2fda071aec77ea347f7a927d5d493a6f81b5bb17141b35188cfb9d934d03cb144be40eeeaed0a58059df17bdd60ade067b6a964bff4f913533703fbf97d16f06ab7c274327823a86e1565915926b0fa3b52cc55e7b812c58235453048f1ed69c71c62cbe5e75f3b5f2074f70b2833807b0b0d06bfadd5c9a036c650bf2fce4cd4053011e0a4554b7c308b8be0d319ef793271c8807a72085fc92d14ee7ef1b52b34f771892bf4ecc1eee97024e9648fbd217b5c326d3b2ef09e493bd4565aa5cacabb2af4a3d72ac1c663a93566202c98619149ef1080d766c4f35da09dde392d1d65d4b83ed8e49d7f8db09035b7bbd1577723a1216522fe42ee5a176a479420b424c4ab038465276c6c9688cbc97f390a3f981ec537c860b426899119dd220ccb787f2839bc4ea2f89961696785eb049d5595e368b3d5527498d9509012173f8533562a1f7260541a9e5b409742e5edf4788125d49ef0361e9621f906fa78f3ec2ac05e127bac033a68f2c8a234f6d1d3ef4a1b7d3984f34f66f72b911ff287e2199ea44359b9c5ca7f5c4bdc17fbc85b0a999128a0a435b04dcd75e30c298cf39763725b1e357d133e7c3b9bf3bbe4c4f17a197f7a8ea44b79eefcfc4e560c23b162c9732f1aa21a8861afa4219f3c2ca99f989d24e6057e4bd056f95f758f74fe1ba2fda2ff80bb28157aadf4533ea8f9cadb92f8f4c14a9f0b50854ce876163947973973e3ec10d10d10794992c0ab8a4e2ddb78e9768ae9e55f5a33d9d3a6184b63bd3567db899ec35d64128ad36da11dc27ba17867185d2201313871f9c04be7975c4ee2a456b4ca9bc34481b6ac6c1e50303e81ac51c7ff78798a456e3bba57ee3dc006dd560685b2fe2071c775bfb7712a7e6247b17460c3521c0e5ca8d31ae24256984fadc4271df194c642d6ac1980f32fc901a6fc6fff55bec3e73b636e1c44f247096161ffda0668c05cf4b6855ef53cf63da6ce1821af6d7543336be4b77f91b4a8e0dbbab204d4e73000aa9606b47594e09b5002e4d83540fae699aff8d59d4807f7045d0df93c3d26f3ef004379fa8cc2d697d276a09d3d86f62818f2827e206ab0b7e2219e014641dc63b67ffeaecb3288cf010c53a0261a9649f2d13ae0b8d0bf667b62ae442642933682b4fec9fd884d875e320996e5c28fab55d828cb4fb03e52178777fbcaaa06138318bcb9eac770134a462e345b907f22c31d3d2c6de4c971d6ac09486aa821f258f7b30d526764e11d8edde8a872512f2d86ed5719a1f2352e45e13540af06dc3e0e54db9695e714c2c1173f94eb72c95e8f1bd0732364814510318c084792e1880705f5a4c3fed6febe49e8a9b70b5dfa354186b649c1b740b97932f53493245bebc97e437286aca4a118c93ff2fa5916780068d737e5ebbcd55cd1d1043bfae985a417d00e2035f9b6ad665aa16a8ea35ff7fac7a786ddf7f74762f3ca2ed3622bfd216bf55983a94e59489aa53c0e3129ba338ce459fcc9b08999b08a47b803bfd3c795208bedf9e1e95c99d69bea7d651f32e343239cf80a955e14471c1f4f47a75b92f8871b7fc734c0132de63c029c484a21450e6a371b5699eee1f8a2476292cf3d2549a6cde86ec3c500cade7b6953a29900f63a555d7fb6be6b7826457f03ad9140f3a39d6b94fd76b688979492026d4068bd490a0e04ee5a4e8b4419306e6494b447770096307a9f835386388979f03cd21cd3edb88a7345e7318889cc5d23cf9092593a980d7e48fb0bc3b5bd0750535047b3204b03e5a5ba5548f94177702edaef891137f29d4478b58052e66fdfc1294fff7acca975bbee2657fc0f190ef6bdd850500f7acdfd6d3bef09827615735ce1ca6dfa92d2395a657739e31796c9b9679996746ab3f92cd5068bed3ea350cdcacf80df16addb5e1f61d93a3f499f5ee7094e03a446205a88a8903a440212f38d80c18fecc91745669de62dac0705c8354c7ae3eba828a95a84f6270dcec376daf599a80c2abaf0524d8110223d0f8d8331dfb993b5febc07879eb90a359c3b16db2d7b362770648c38347a7eb85841b5f7033e146e6465cc8feab0844d878dc53179514a9e4dfa335cec18d1470bf57d5b6adbc26d5c384107bf50aecd1bd54eb6eaf3768576486d7f9a428c711b2e8cacc3654b8d0c5f2c390b547c2b9ca3ffb3bb4af8a62396c7487a699fea5a7979a6fd1b1915301f5c88fa856642b00df106dbce86a42865856ac52aff4ccf9f32cb0a7423fe47158cdbaad4c0c5ff61fba6ce42e6239143a5845f01464c712cf601bca16412db95f00ff5fd74752307708c49a1a82f66f11b377346974220606675dcdc835fb88df7887593520a0b7ecf2d5c210f330fdbf3498150044d3c4dbaf979cbeaa31102b78770581e2d75c22ccfd053c3ada4a23ff8c6599e21cf30c9a3fa8a37bc1503ef5432a61a32a7edc0b51c450b4526560d6be1c78571d5ac8f1d677fcdccf566286b090e38cf04601ba8fad64ee2ff936e4a31dde2f2ad685f0bec91248524ba2e9b9db971202f3a9a9671e6b001f360b406c372567e3e576593465387c384cae0f41f10e9e97a149484f638702de63f06a81dd6320746f24dab7686f819a839cfaafe89e9b1789cef3d6143245195294f0762647c5c2d18ebf0179dcfd600551fe3a458b14e078cbd8f78cfa21c300b9502dd20a0277fa03603a9d742a4f884af3e4a3738cbea487a4dd0b602a8811a7f545f6347e0d2184d58bddc092e39a4f1bda9f8ab46a7b8aa9f93e383e5e369c101c97216b0fc84ec1f1e40753e8a1f7a3b586d1e4b20fe70d8c21c0aaf55297208cdc8fe84d617a3f7872221e21315b48569630439a85238f3b0e0dc1c96a04cb220e1097781f48f48f50bbad40de5ccde9b950647c03767318d3d411bc9cf3dbf5ce61940234877ff34f9f91019a993529e9e8943f2fccf5ff3febcada19853a4feb7192150bbbeb1581c68f50e7b67867f1e64c021058adc93eb985db1bcd52b02c1e32fe0bd7ed99ebc25f11340a0be1815fdae3099dd3186a8b4efbdf63928d25b7ad06064c333f05f2157a345394a35acb66ad3b3ca4aea9118da607e22f9985e39b7b529a6c8985cd9c3358874edbd4dbb133c1dc04942a7948570a6d3808e50118793fb62dabd7bcca26927652169d1fec9e4570639ee0164d9fe1c9b29cd18f765974dfc47656f1abba707e86ab30115711cfd7162c3d0d70116a62a72a9ab8471f9bb7ad031384dea33d57baf703b1cb25fa9ae46e7841c658f210c4c9c1e4c56ec283a015643476e219cd6813813f3831ea829bd3c3eb32eae7f0234503b760b7c12cff0b1a655d649b6bcffa511ce95a961155becdfd5600bc58581c94ce500c17b833e128735fe6e9bf0c4983035db4cd5de4b365f0e71e5ebf936d029e3c84ba05e6863fa997e4a61006e7714ee708d10ae1f2d6bd23222db45a8e691b809c600ebf948bc882d3b22b514881bf63de9ebe0ff392c3b8ff11523c5bed75abd9809531f2a759f5f458c750005846110647742ce1f8e71518bf41371f5e9d892cf70b00081942b98a3c7f1ae09da855810733a4d5ad39cd49be36858f920d8c02b7b9c9f9d43f84e075477fba94f71de9d290500c2ada8c18c7641310974d155508aa5d408b6c7ab587f9926e17a446b2d0207aefe86e9879640a327feb151439883258688bf2a1aec4070849a499cbfdb351ea5aa0dbe8a35be53c745f6f291342e73519d3c980c7dfb46b3df1ad03b5e86c6b2dfb5a7b243c5ab1c74dd087103c91a8bcbbf7ea6cd0c939bc5504d422f7ccec67729678111d0d439ff76e9caaf784c4862e9fbec2fd1aa67fdeacf6d00ee411d96a99b4332bfccaace390e7d7c1e731e3db08d8079cd7cc7649a091ccb43452c95e159a5d460a900624e4fbb579f2a8bfbd9a3a4f5cec4fcab706c38b99cf8218ecb12aad8174dd0704cd13fbd4788dbeba9d88703eeda4a1ae572f9c6c43b5f9f88da79b184b568f6af38d97cf1dd1dc731ecbf875beebd58c42e243e7f6f233c981083e4eaa241791913023289cf60ccdc919c6297be38b63c250c2fbf6f58a37a1be9c750451b0ca0cf54d27248cb5ea8dfaf6ef8913f83fcd37b93ea684872d12f8e4ead3110f8f8ba3018117e1fe314e974e73b37d252afeeadc30df66a1b6b3467451aa662caefe10f27a5d685c5c23409a10fb15dfbdcd4903928dc0b2059534333b9440b7d90c366341f09cea107649c9a695622becb8256c15660e45e0216e3790d14fae96ac3e7229de59bc3dbc84b39202be5ee28d7506dec78fd29a462c108e39505586f662bb012d3450761c786647d24418ae1e9ab97a1ff1f25cdd5ea54a0a5975dde2fea21cc06671d12b762dad247cdaf35b5181</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">这里需要密码才能访问。</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密博文，请输入密码后查看</summary>
    
    
    
    <category term="心情驿站" scheme="https://ephen.me/categories/emo/"/>
    
    
  </entry>
  
  <entry>
    <title>使用公共 DNS 上网的弊端（二）</title>
    <link href="https://ephen.me/2017/PublicDns_2/"/>
    <id>https://ephen.me/2017/PublicDns_2/</id>
    <published>2017-08-17T16:00:00.000Z</published>
    <updated>2022-03-17T07:04:28.452Z</updated>
    
    <content type="html"><![CDATA[<p>上一篇文章《<a href="/2017/PublicDns_1/">使用公共 DNS 上网的弊端（一）</a>》我讲到当我们使用公共 DNS 上网时可能会因为该 DNS 的出口与本地实际网络所属区域和运营商不一致而导致调度不准，进而影响连接速度可能变慢。这篇文章同时发到了咱们 CloudXNS 的微信公众号上，不少小伙伴与我们产生了互动。</p><p>有的小伙伴就问到：“如果是支持 Edns-Client-Subnet 的公共 DNS，还会存在我说的问题吗？”</p><p>不得不佩服小伙伴们的学识！（比灰姑娘可厉害多了……</p><span id="more"></span><h2 id="什么是-Edns-Client-Subnet-？"><a href="#什么是-Edns-Client-Subnet-？" class="headerlink" title="什么是 Edns-Client-Subnet ？"></a>什么是 Edns-Client-Subnet ？</h2><p>Edns-Client-Subnet，简称 ECS，是由 Google 提交的一份 DNS 扩展协议，主要作用是允许 DNS resolver 传递用户的 IP 地址给权威 DNS 服务器。</p><p>关于 ECS 的 RFC 草案提出了很多年，直到 2016 年 5 月才被纳入正式 <a href="https://tools.ietf.org/html/rfc7871">RFC 7871</a>。</p><p>过去我曾在 CloudXNS 官方文章 《【CloudXNS 教您几招】如何让多 ip 域名配置游刃有余？[1]》中侧面提到过关于 ECS 的概念及测试示例，感兴趣的小伙伴可以先去看看。</p><h3 id="ECS-支持现状"><a href="#ECS-支持现状" class="headerlink" title="ECS 支持现状"></a>ECS 支持现状</h3><p>过去 ECS 一直作为一个 RFC 草案存在，真正成为规范至今也仅仅一年。</p><p>如果要让域名的来访用户真正能访问到正确的区域和运营商站点，不仅仅用户使用的本地 DNS 要支持 ECS，同时域名使用的权威 DNS 也要支持。</p><p>而事实上，ECS 的普及程度并不高。目前市场上支持 ECS 的权威 DNS 不多，支持 ECS 的递归 DNS 更是少之又少。像在中国，就并没有哪个运营商的本地 DNS 支持。 </p><p>同时，更多的网站主并不很了解 DNS 相关业务知识。大多数站主随便找个注册商购买了一个域名然后填写几条记录并完事，懂得多点的知道找个智能 DNS 做分区解析。仅此而已。</p><p>那么，假设域名使用了支持 ECS 的智能 DNS 和 CDN，访问的用户也使用支持 ECS 的公共 DNS，这中间还会不会有什么问题呢？</p><h2 id="ECS-的弊端"><a href="#ECS-的弊端" class="headerlink" title="ECS 的弊端"></a>ECS 的弊端</h2><h3 id="访问网站时的解析时间将可能增加"><a href="#访问网站时的解析时间将可能增加" class="headerlink" title="访问网站时的解析时间将可能增加"></a>访问网站时的解析时间将可能增加</h3><p>我们知道，DNS 是有逐级缓存的。我们常常访问的网站大多可以直接从本地 DNS 缓存中读取解析结果，只有当我们是整个区域及运营商中访问某个冷门站点的第一个用户，才会最终到权威 DNS 上去查询站点的解析结果。这时候解析时间会远高于访问热门站点。（不懂的话，再去温习一下《<a href="/2015/dns-theory/">转载：从理论到实践，全方位认识DNS（理论篇）</a>》</p><p>如果 DNS 查询请求使用包含 ECS 信息（比如 192.168.1.0&#x2F;24 ），那么 DNS 响应会返回一个 &#x2F;0，即为每个人缓存。这代表每个子网的缓存结果都是独立的，如果你的子网中过去从未有人使用支持 EDNS 的本地 DNS 访问过某个网站，这意味着你将从头走一遍域名解析。</p><h3 id="ECS-可能也并不能解决网络归属问题"><a href="#ECS-可能也并不能解决网络归属问题" class="headerlink" title="ECS 可能也并不能解决网络归属问题"></a>ECS 可能也并不能解决网络归属问题</h3><p>在 <a href="https://tools.ietf.org/html/rfc7871">RFC 7871</a> 中有提到，当增加 ECS 信息后将可能带来生日攻击（章节 11.2）。为了解决这个问题，当响应包中的 ECS 选项不够完整时，则应该被丢弃该 ECS 回复，即使请求中有 ECS 信息。</p><p>那么一旦这种例外的情况在用户的一般使用中出现，这个 DNS 便依然解决不了用户网络归属的问题。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>事实上，网络延迟和 DNS 解析是网站访问中很重要但可能并不会明显拖慢速度的环节。我们仍可以综合考虑访问速度和安全等多方面来选择使用本地递归 DNS：净网大使选个优质的公共 DNS，懒癌患者就自动获取 DNS，某 DNS 的钟情粉丝就继续抱住你那家那位去吧。</p><p>要是你是个仅仅只追求速度的 Windows PC 用户，CloudXNS 提供的“_<strong>一键优化 DNS 设置</strong>_”（<a href="http://d3.yjyiy.com:806/1408/cloudxnsyjyh.bkill.com.zip">点击下载</a>）工具可以一用。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;上一篇文章《&lt;a href=&quot;/2017/PublicDns_1/&quot;&gt;使用公共 DNS 上网的弊端（一）&lt;/a&gt;》我讲到当我们使用公共 DNS 上网时可能会因为该 DNS 的出口与本地实际网络所属区域和运营商不一致而导致调度不准，进而影响连接速度可能变慢。这篇文章同时发到了咱们 CloudXNS 的微信公众号上，不少小伙伴与我们产生了互动。&lt;/p&gt;
&lt;p&gt;有的小伙伴就问到：“如果是支持 Edns-Client-Subnet 的公共 DNS，还会存在我说的问题吗？”&lt;/p&gt;
&lt;p&gt;不得不佩服小伙伴们的学识！（比灰姑娘可厉害多了……&lt;/p&gt;</summary>
    
    
    
    <category term="知识探索" scheme="https://ephen.me/categories/knowledge/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="Public DNS" scheme="https://ephen.me/tags/Public-DNS/"/>
    
    <category term="Local DNS" scheme="https://ephen.me/tags/Local-DNS/"/>
    
    <category term="Recursion DNS" scheme="https://ephen.me/tags/Recursion-DNS/"/>
    
    <category term="edns-client-subnet" scheme="https://ephen.me/tags/edns-client-subnet/"/>
    
  </entry>
  
  <entry>
    <title>使用公共 DNS 上网的弊端（一）</title>
    <link href="https://ephen.me/2017/PublicDns_1/"/>
    <id>https://ephen.me/2017/PublicDns_1/</id>
    <published>2017-08-03T16:00:00.000Z</published>
    <updated>2023-05-25T06:03:53.010Z</updated>
    
    <content type="html"><![CDATA[<p>作为资深网民的我们都知道，本地 DNS 是非常重要的，它能决定你到底能不能上网。</p><p>由于本地运营商 DNS 常常被大家诟病容易遭到劫持等风险，使得很多人选用公共 DNS 来作为本地上网用的 DNS ，例如 114DNS 、阿里 DNS 等。</p><p>但是，喜欢用公共 DNS 的你，知道公共 DNS 在上网时会有什么弊端吗？</p><span id="more"></span><h2 id="智能-DNS-和-CDN-简介"><a href="#智能-DNS-和-CDN-简介" class="headerlink" title="智能 DNS 和 CDN 简介"></a>智能 DNS 和 CDN 简介</h2><p>中国国内的互联网环境复杂，跨地区跨运营商之间的网络延迟较大，所以出现有智能 DNS 和 CDN 来解决这个问题。我所在的公司，北京快网就是咱们国内一家老牌的 CDN 服务提供商；CloudXNS 是一款智能 DNS 域名解析产品。</p><p>如果互联网站主财大气粗技术牛，在全国各地各运营商乃至全球都专门独立部署了站点，那么他可以通过智能 DNS 分区分运营商分别将域名解析到对应的站点；如果站主不具备这样多点部署的条件，那么他可以通过我们公司完成 CDN 的需求。</p><p>这就是智能 DNS 和 CDN 的最初的应用。</p><p>没错，就是【加速】。让北京联通的网民能访问到北京联通（或附近同运营商）的站点，广东电信访问到广东电信（或附近同运营商）的站点，从而达到加速的目的。</p><p>而智能 DNS 或 CDN 在调度判断网民归属时，是通过网民的本地 DNS 所属 IP 段来的。</p><p>所以，今天我要讨论到的公共 DNS 上网的弊端就是：<strong>它一定程度上违背了智能 DNS 和 CDN 加速的规则</strong>，变得不快了。</p><h2 id="本地-DNS-和公共-DNS"><a href="#本地-DNS-和公共-DNS" class="headerlink" title="本地 DNS 和公共 DNS"></a>本地 DNS 和公共 DNS</h2><p>网民在访问网站时，其本地 DNS 会去请求网站地址，如果本地 DNS 没有，它会再向上级 DNS 请求查询。</p><p>公共 DNS 是由一些企业提供的本地 DNS 服务，通常会给用户提供一个或多个 Anycast IP ，但实际背后有多个集群服务。</p><p>当用户上网时，客户端会向这个集群中的 A 地址请求解析，这个 A 地址被称为 DNS 入口；智能 DNS 在判断网民用户来源时，会使用 DNS 集群中的 B 地址与 IP 库进行比对，这个 B 地址被称为 DNS 出口。</p><p>所以上网过程中，用户将从 DNS 入口获取解析，NS 服务器会向 DNS 出口分配智能解析。如果用户的 DNS 入口没有请求的解析缓存时，将向上级 DNS 请求查询，最终会请求到 NS 服务器，然后用户才获取到解析结果。</p><p>那么当用户的 DNS 入口和 DNS 出口和用户的实际网络不一致时，就可能导致智能 DNS 提供的解析结果并不是最优的。</p><h2 id="测试示例"><a href="#测试示例" class="headerlink" title="测试示例"></a>测试示例</h2><p>北京快网官方门户网站 <code>www.fastweb.com.cn</code> 使用了<code>牛盾云安全</code>作了页面加速和安全防护，正常情况下使用运营商 DNS 在全国各地的解析情况如下图所示：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154730.png" alt="FastWeb 分区解析"></p><p>这是通过智能 DNS 和 CDN 双剑合璧的最优解析结果。</p><p>例如灰姑娘所在地是湖北武汉，当使用本地运营商 DNS 并存在缓存时，<code>ping www.fastweb.com.cn</code>时延如下：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154755.png" alt="本地 DNS "></p><p>而我在本地模拟<code>ping</code>浙江台州的牛盾节点<code>122.226.182.43</code>，会看到时延稍微长一些：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154839.png" alt="牛盾台州"></p><p>那么公共 DNS 的出入口会不会跟实际网络不一致呢？</p><h3 id="公共-DNS-的入口"><a href="#公共-DNS-的入口" class="headerlink" title="公共 DNS 的入口"></a>公共 DNS 的入口</h3><p>以阿里 DNS 223.5.5.5 为例。</p><p>我在本地对阿里 DNS 的做了一个路由跟踪：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154905.png" alt="DNS入口"></p><p>可以发现，阿里 DNS 的入口在浙江杭州，而我本地网络是湖北电信。</p><h3 id="公共-DNS-的出口"><a href="#公共-DNS-的出口" class="headerlink" title="公共 DNS 的出口"></a>公共 DNS 的出口</h3><p>刚刚和北京同事进行远程会议时提到这个议题，正好他的 PC 配置的是阿里公共 DNS ，我们让他查询了其出口 DNS ，得到的反馈如下：</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154956.png" alt="出口DNS"></p><p>本地网络北京联通，出口 DNS 竟是广东电信，这远远比我前述举例的湖北电信和浙江电信的差距大得多。</p><h3 id="解析影响验证"><a href="#解析影响验证" class="headerlink" title="解析影响验证"></a>解析影响验证</h3><p>该同事分别用阿里和运营商 DNS 对网易域名做了测试对比。</p><p><em>使用阿里 DNS 测试结果：</em></p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426155020.png" alt="阿里 DNS"></p><p><em>使用运营商 DNS测试结果：</em></p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426155043.png" alt="运营商 DNS"></p><p>使用运营商 DNS 时，<code>ping</code> 值快得多。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;作为资深网民的我们都知道，本地 DNS 是非常重要的，它能决定你到底能不能上网。&lt;/p&gt;
&lt;p&gt;由于本地运营商 DNS 常常被大家诟病容易遭到劫持等风险，使得很多人选用公共 DNS 来作为本地上网用的 DNS ，例如 114DNS 、阿里 DNS 等。&lt;/p&gt;
&lt;p&gt;但是，喜欢用公共 DNS 的你，知道公共 DNS 在上网时会有什么弊端吗？&lt;/p&gt;</summary>
    
    
    
    <category term="知识探索" scheme="https://ephen.me/categories/knowledge/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="Public DNS" scheme="https://ephen.me/tags/Public-DNS/"/>
    
    <category term="Local DNS" scheme="https://ephen.me/tags/Local-DNS/"/>
    
    <category term="Recursion DNS" scheme="https://ephen.me/tags/Recursion-DNS/"/>
    
  </entry>
  
  <entry>
    <title>成功取得项目管理专业人士资格认证</title>
    <link href="https://ephen.me/2017/GetPMPCertificate/"/>
    <id>https://ephen.me/2017/GetPMPCertificate/</id>
    <published>2017-07-24T16:00:00.000Z</published>
    <updated>2023-05-25T06:00:46.754Z</updated>
    
    <content type="html"><![CDATA[<p><strong>各位看官请注意：</strong></p><p><strong>此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。</strong></p><span id="more"></span><hr><p>其实就是个 PMP 考试。</p><p>PMP ，全称 Project Management Professional，由美国项目管理协会（Project Management Institute(PMI)）发起的，严格评估项目管理人员知识技能是否具有高品质的资格认证考试。</p><p>这年头，考 PMP 的通过率真的蛮高。但，持续学习是一种精神。要问自己从备考过程中学到了什么，通过考试只是附加值而已。</p><p>当然，没有通过会是很桑心的，毕竟花了好几千大洋呀。虽说不花钱照样能学到东西，但是花钱了没花钱那学习态度肯定是不一样的。花钱报考，只是个学习的助推剂罢了。</p><hr><p>所谓项目管理，是把一件事情做好的统筹方法。这件事情就是个项目，譬如开发一个产品卖到客户手上，又譬如考个 PMP 证书。</p><p>在这个知识体系中，主要可通俗理解到如下几个方面：</p><ol><li>在项目的初始，作为 PM 要认识到为什么要做这个项目，以及如果要做这个项目要与哪些人搭上关系；</li><li>接着，梳理需求、划定范围，并为项目创建关于时间进度、人力、成本、质量、风险、采购、沟通等方方面面的计划；</li><li>按计划执行项目的时候，合理管理人员做好团队建设，制定一系列的工作质量标准 SOP 流程；</li><li>各角度反复监控执行过程，让项目的进程不偏离既定的计划轨道；</li><li>最终完成项目，交付给客户，并形成经验教训。</li></ol><p>也就是 PMP 管理体系中的<code>启动</code>、<code>规划</code>、<code>执行</code>、<code>监控</code>和<code>收尾</code>五大过程组。</p><p>由于它并不局限于某个行业或某一类行业，所以其内容非常繁杂，并且以人为本的因素很多。因而对于整个体系的理解，并结合项目经验显得尤为重要。</p><hr><p>在这次备考过程中，我在理解知识体系的时候代入的是我在上家公司的工作经验。</p><p>上家公司我就是身在一个软件实施项目组，参与并负责完成了项目中的很多事情，加之公司的工作流程非常标准（不记得是 CMMI4 还是 CMMI5 级别），学习过程中的所有活动我都能找到工作原型。所以尽管备考过程也比较辛苦，但是相对来说，我还是比较轻松的。</p><p>我想了下，如果我从没有上家公司的工作经历，仅仅是在武汉快网的环境下，也许会吃力得多。武汉快网的管理是互联网扁平化风格，工作中与大部分管理知识没有交集。</p><p>不过像 PMBOK 开篇就提出的，任何管理都是要基于企业文化的，并不是说符合书中就是最好的，不符合就不好。<strong>适合的才是最好的。</strong></p><hr><p>要参加 PMP 考试是必须要报培训班的，我在武汉报的是“世纪卓越”，有人也想报名的话可以找我推荐。好像推荐可以少交点培训费吧，不过我并得不到好处的唷~</p><p>周末班上课，压力是挺大的。从早上 9 点除了中午约一小时吃饭时间外连续上到下午 5:30 ，上午下一次课，下午下两次课，时间仅够排队去上厕所的。讲课内容很多很满，上起课来可能会觉得脑容量不太够。</p><p>为什么压力这么大呢？</p><ol><li>PMP 一年考试 4 次，每季度一次，然后这些培训讲师会到多个地方授课，带很多很多的学生；</li><li>PMP 考试 pmi 不会提供原题和答案，这些培训公司和老师们要组织和整理每一次刚考完的考生记题并讨论出标准的权威的答案；</li><li>老师要写书、写讲义，之后再根据讲义讲课；</li><li>一般学生要先预习后再上课，内容很多，大家又都是上班族。</li></ol><p>所以上课时间就压缩到考前一个月了。总共上 5 天课，安排一天模拟考，3个周末搞定这些。</p><p>马上 2018 年就要换 PMP 教材了，建议有考虑考 PMP 并且还没开始行动的童鞋最早报明年 9 月份的吧。一来是错峰（今年的报考人数井喷得不行），二来让前面俩季度的学生试试水、讲师再积累下新版本经验，再来就是刚换教材可能不会有较大的难度。</p><p>我们今年的考试很难。听说还有些新版中的超纲内容，大概今年的几次考试都是为版本过渡而生的。</p><hr><p>这次考试，除了我要学的知识，还收获了很多。</p><p>一开始刚报名的时候没进入状态，后来发现群里的小伙伴们都有很多人书看完了还梳理了各种心得，我就慌了。</p><p>我把书放在公司，每天晚上在公司加班看书学习，并且一有时间就泡在群里尝试着给同学们解答问题。</p><p>因为我经常回答问题，所以收获了很多朋友。我在武汉组织了一个学习小组，然后深圳也有一些小伙伴组了个<code>学霸</code>群。</p><p>哈，其实<code>学霸</code>群就是备考累了歇息用的吹水群辣。。看起来大家都在争自己怎样怠慢学习，又暗暗较劲的要考个好成绩，再去攻其他的证书。</p><p>最终我两个群的小伙伴全数通过考试。</p><hr><p>证书证书，这肯定是要晒的咯！</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426161446.png" alt="PMP证书"></p><hr><p><strong>未经允许，不得传播此文中图片及任何个人信息。</strong></p><p><strong>情节严重者，将追究其法律责任。</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;strong&gt;各位看官请注意：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;此文章涉及本姑娘个人信息，文章公开代表逛到这里的人可以看，但并不代表我同意被传播。&lt;/strong&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="心情驿站" scheme="https://ephen.me/categories/emo/"/>
    
    
    <category term="项目管理" scheme="https://ephen.me/tags/project-management/"/>
    
  </entry>
  
  <entry>
    <title>什么情况下 DNS 会使用 TCP 传输协议？</title>
    <link href="https://ephen.me/2017/dns-tcp/"/>
    <id>https://ephen.me/2017/dns-tcp/</id>
    <published>2017-07-16T16:00:00.000Z</published>
    <updated>2023-05-25T05:59:36.570Z</updated>
    
    <content type="html"><![CDATA[<p>我们知道， DNS 是同时占用 UDP 和 TCP 的 53 端口传输数据的，这种单个应用协议同时使用两种传输协议的情况，在 TCP&#x2F;IP 栈中也算是个异类。</p><p>当我们在使用 tcpdump 、 WireShark 等抓包工具分析时，会发现几乎所有的 DNS 应用都是在使用 UDP 传输。</p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154104.png" alt="DNS查询使用UDP协议传输"></p><p>那么，为什么 DNS 还要占用 TCP 的端口，到底什么情况下才会用到 TCP 呢？</p><span id="more"></span><hr><h2 id="一点基础知识"><a href="#一点基础知识" class="headerlink" title="一点基础知识"></a>一点基础知识</h2><p>TCP 全称 Transmission Control Protocol （传输控制协议）， UDP 全称 User Data Protocol （用户数据报协议），它们都是 OSI 七层模型中的传输层协议。灰姑娘大学时是网络工程专业的学渣，虽没学到个啥，但好巧不巧，就记得某些考题逢考必有。比如：</p><h3 id="TCP-和-UDP-的区别"><a href="#TCP-和-UDP-的区别" class="headerlink" title="TCP 和 UDP 的区别"></a>TCP 和 UDP 的区别</h3><table><thead><tr><th>特性</th><th>TCP</th><th>UDP</th></tr></thead><tbody><tr><td>连接性</td><td>三次握手</td><td>不需要建立连接</td></tr><tr><td>可靠性</td><td>可靠，丢包会自动重传</td><td>不可靠</td></tr><tr><td>有序性</td><td>会对传输乱序的消息重新排列</td><td>可能乱序</td></tr><tr><td>传输速度</td><td>慢，因为要建立连接并保证可靠和有序</td><td>快</td></tr><tr><td>传输及控制</td><td>通过字节流传输，无界，有拥塞控制机制（慢开始、拥塞避免、快重传、快恢复）</td><td>数据包都是单独的，有界，不作拥塞控制</td></tr><tr><td>资源消耗</td><td>需要更多资源以传递更多信息，包头比较大（需要 20 字节）</td><td>头部只需 8 个字节</td></tr></tbody></table><p>通过上述区别，我们不难看出， TCP 主要应用在对可靠性比较高的场合，比如 Telnet 、 FTP 等；而 UDP 主要应用于实时性较高的场合，例如即时聊天。</p><h2 id="DNS-查询用的传输协议"><a href="#DNS-查询用的传输协议" class="headerlink" title="DNS 查询用的传输协议"></a>DNS 查询用的传输协议</h2><p>前面提到，一般我们看到的绝大多数 DNS 查询是用的 UDP 传输。</p><h3 id="域名解析时大多使用-UDP-协议"><a href="#域名解析时大多使用-UDP-协议" class="headerlink" title="域名解析时大多使用 UDP 协议"></a>域名解析时大多使用 UDP 协议</h3><p>客户端在请求一个域名的解析结果时，实际上需要经过重重 DNS 查询。（对 DNS 不太了解的童鞋可以先学下这个：<a href="/2015/dns-theory/">转载：从理论到实践，全方位认识DNS（理论篇）</a>）</p><p>一方面，要保证用户端的快速响应， TCP 的三次握手则过于繁冗；另一方面， DNS 解析查询即使出现异常，网民用户大不了重新申请一次查询，因而对可靠性的要求并没有那么高。</p><p>所以日常的域名解析需求使用 UDP 传输即可。</p><h3 id="具备特殊要求的域名解析使用-TCP-协议"><a href="#具备特殊要求的域名解析使用-TCP-协议" class="headerlink" title="具备特殊要求的域名解析使用 TCP 协议"></a>具备特殊要求的域名解析使用 TCP 协议</h3><p>由于UDP是按照数据包来传输的，整个包最大只能 512 字节。一般正常情况下，用来 DNS 查询是绰绰有余的。但当解析配置过于复杂，或者记录值过长（如： TXT 、 RRSIG 记录）使得 UDP 无法承载的情况下，就有必要转换 TCP 查询。</p><p>由于基于 TCP 的域名解析非常少见，大多数域名厂商是不支持的， CloudXNS 也不例外。然而同域名同主机同线路的同类型解析将会封装到一个 UDP 包传输，如果内容过多（超过 512 字节），该数据包可能会承载不下。</p><p>这也是为什么 CloudXNS 中即使 A 、 TXT 、 MX 等类型记录尽管不与自身互斥，我们仍然会对同域名下同一主机同一线路限制解析记录条数的原因。</p><p>当然，国外的一些域名解析商这方面可能比我们严谨些，还是有一部分厂家是支持当数据过长时转用 TCP 传输的。比如：<a href="https://dns.he.net/">He.Net</a></p><blockquote><p>我们来做个测试：</p></blockquote><ol><li>将 <code>chinatesters.com</code> 配置一个子域名 <code>test</code> ， NS 指向 He.net 的域名服务器。如图所示：<br><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154445.png" alt="子域 DNS 配置"></li><li>将 <code>test.chinatesters.com</code> 添加到 He.net 的域名控制面板，并添加一条 TXT 记录，值为<code>11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111</code>（长度： 768 ）。如下图：<br><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154534.png" alt="超长 TXT 记录配置"></li><li>配置生效后，使用 <code>tcpdump</code> 跟踪本地网卡的 53 端口，同时新开窗口用 <code>dig</code> 命令直接向 <code>ns1.he.net</code> 请求查询该 TXT 记录。</li></ol><p><em>DNS 查询记录：</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#dig aaaaaaaaaa.test.chinatesters.com TXT @ns1.he.net</span><br><span class="line">;; Truncated, retrying in TCP mode.</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6 &lt;&lt;&gt;&gt; aaaaaaaaaa.test.chinatesters.com TXT @ns1.he.net</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 56555</span><br><span class="line">;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line">;; WARNING: recursion requested but not available</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;aaaaaaaaaa.test.chinatesters.com. INTXT</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">aaaaaaaaaa.test.chinatesters.com. 300 IN TXT&quot;111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; &quot;011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; &quot;101111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111&quot; &quot;11&quot;</span><br><span class="line"></span><br><span class="line">;; Query time: 221 msec</span><br><span class="line">;; SERVER: 216.218.130.2#53(216.218.130.2)</span><br><span class="line">;; WHEN: Tue Jul 18 13:58:50 2017</span><br><span class="line">;; MSG SIZE  rcvd: 833</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><em>tcpdump 网卡跟踪记录：</em></p><p><img src="https://iephen.pek3b.qingstor.com/b_image/20190426154616.png" alt="tcpdump 网卡跟踪"></p><p>查询记录结果的第一句便提示了 <code>Truncated, retrying in TCP mode.</code> ，表示启用了 TCP 协议查询。</p><p>网卡抓包也展示了 <code>seq</code> 、 <code>ack</code> 等 TCP 协议中的三次握手过程，最后返回了域名 <code>aaaaaaaaaa.test.chinatesters.com.</code> 的 TXT 记录值。</p><p>事实上，根据 <a href="https://tools.ietf.org/html/rfc1035">RFC 1035</a> 章节 4.2 ，<strong>DNS 解析查询优先使用 UDP ，当 UDP 完成不了的情况下，则转换 TCP 查询</strong>。上述展示的就是这样的实例。</p><p>当看完 RFC 的这一章节，我们会发现，基于 TCP 协议的 DNS 应用还有一个更重要的作用。</p><h2 id="DNS-区域传送（zone-transfer）"><a href="#DNS-区域传送（zone-transfer）" class="headerlink" title="DNS 区域传送（zone-transfer）"></a>DNS 区域传送（zone-transfer）</h2><p>由于 DNS 服务器作为互联网基础设施，一般都会分布式的设置多台冗余备份，各个域名的配置在多个服务器之间的同步过程便被称之为区域传送。我在过去的文章《<a href="/2016/dotkp-zone-dns-remove/">隔壁粗事了！朝鲜顶级域 .kp 域名 DNS 数据配置可被转移</a>》中提到过“区域传送”的概念，不太了解的童鞋可先查看下。</p><p>区域传送时，辅域名服务器将向主服务器拉取数据。该数据同步传送的量往往比较大且不容有失，该操作没有较高的时效性要求只需要隔段时间定时执行一遍即可。所以<strong>必须采用可靠性高的 TCP 传输协议</strong>。</p><p>CloudXNS 的 NS 服务器间的区域同步技术是公司自研的一套机制，虽然亦是使用的 TCP 传输，但由于专利技术保密，不便提供示例。下次咱们大概可以在搭建一套开源的 DNS 服务器的折腾过程中再引申下关于区域传送时应用 TCP 协议的知识。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li>《计算机网络（第五版）》.谢希仁</li><li><a href="https://tools.ietf.org/html/rfc1034">RFC 1034</a></li><li><a href="https://tools.ietf.org/html/rfc1035">RFC 1035</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;我们知道， DNS 是同时占用 UDP 和 TCP 的 53 端口传输数据的，这种单个应用协议同时使用两种传输协议的情况，在 TCP&amp;#x2F;IP 栈中也算是个异类。&lt;/p&gt;
&lt;p&gt;当我们在使用 tcpdump 、 WireShark 等抓包工具分析时，会发现几乎所有的 DNS 应用都是在使用 UDP 传输。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://iephen.pek3b.qingstor.com/b_image/20190426154104.png&quot; alt=&quot;DNS查询使用UDP协议传输&quot;&gt;&lt;/p&gt;
&lt;p&gt;那么，为什么 DNS 还要占用 TCP 的端口，到底什么情况下才会用到 TCP 呢？&lt;/p&gt;</summary>
    
    
    
    <category term="知识探索" scheme="https://ephen.me/categories/knowledge/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="TCP" scheme="https://ephen.me/tags/TCP/"/>
    
    <category term="UDP" scheme="https://ephen.me/tags/UDP/"/>
    
    <category term="协议" scheme="https://ephen.me/tags/protocol/"/>
    
  </entry>
  
  <entry>
    <title>SSL 证书颁发机构将对域名强制 CAA 检查，到底什么是 CAA ？ CAA 记录详解</title>
    <link href="https://ephen.me/2017/dnsrr-caa/"/>
    <id>https://ephen.me/2017/dnsrr-caa/</id>
    <published>2017-06-12T16:00:00.000Z</published>
    <updated>2022-02-22T06:14:18.162Z</updated>
    
    <content type="html"><![CDATA[<h2 id="强制-CAA-检查的提议"><a href="#强制-CAA-检查的提议" class="headerlink" title="强制 CAA 检查的提议"></a>强制 CAA 检查的提议</h2><p>2017 年 3 月 7 日， CA|B Forum （一个全球证书颁发机构与浏览器的技术论坛）发起了一项关于对域名强制检查 CAA 的一项提议的投票，获得 187 票支持，投票有效，提议通过。</p><p>提议通过后，将于 <strong>2017 年 9 月 8 日</strong>根据 Mozilla 的 Gervase Markham 提出的检查 CAA 记录作为基准要求来实施。</p><p>详情参见： <a href="https://cabforum.org/2017/03/08/ballot-187-make-caa-checking-mandatory/">Ballot 187 – Make CAA Checking Mandatory</a></p><h2 id="什么是-CAA-记录？"><a href="#什么是-CAA-记录？" class="headerlink" title="什么是 CAA 记录？"></a>什么是 CAA 记录？</h2><p>CAA ，全称 Certificate Authority Authorization ，即证书颁发机构授权。它为了改善 PKI （ Public Key Infrastructure ：公钥基础设施）生态系统强度、减少证书意外错误发布的风险，通过 DNS 机制创建 CAA 资源记录，从而限定了特定域名颁发的证书和 CA （证书颁发机构）之间的联系。从此，再也不能是任意 CA 都可以为任意域名颁发证书了。</p><span id="more"></span><p>关于 CAA 记录，其实早在 4 年前便在 <a href="https://datatracker.ietf.org/doc/rfc6844/">RFC 6844</a> 中有定义，但由于种种原因配置该 DNS 资源记录的网站寥寥无几。如今， SSL 证书在颁发之前对域名强制 CAA 检查，就对想要 https 访问的网站域名提出了解析配置的要求。</p><h2 id="CAA-资源记录详解"><a href="#CAA-资源记录详解" class="headerlink" title="CAA 资源记录详解"></a>CAA 资源记录详解</h2><p>CAA 记录可以控制单域名 SSL 证书的发行，也可以控制通配符证书。当域名存在 CAA 记录时，则只允许在记录中列出的 CA 颁发针对该域名（或子域名）的证书。</p><p>在域名解析配置中，咱们可以为整个域（如 example.com ）或者特定的子域（如 subzone.example.com ）设置 CAA 策略。当为整域设置 CAA 资源记录时，该 CAA 策略将同时应用于该域名下的任一子域，除非被已设置的子域策略覆盖。</p><h3 id="CAA-记录格式"><a href="#CAA-记录格式" class="headerlink" title="CAA 记录格式"></a>CAA 记录格式</h3><p>根据规范（ <a href="https://www.rfc-editor.org/rfc/rfc6844.txt">RFC 6844</a> ）， CAA 记录格式由以下元素组成：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CAA &lt;flags&gt; &lt;tag&gt; &lt;value&gt;</span><br></pre></td></tr></table></figure><p>释义：</p><table><thead><tr><th>元素</th><th>说明</th></tr></thead><tbody><tr><td>CAA</td><td>DNS 资源记录类型</td></tr><tr><td><code>&lt;flags&gt;</code></td><td>认证机构限制标志</td></tr><tr><td><code>&lt;tag&gt;</code></td><td>证书属性标签</td></tr><tr><td><code>&lt;value&gt;</code></td><td>证书颁发机构、策略违规报告邮件地址等</td></tr></tbody></table><p><code>&lt;flags&gt;</code> 定义为 0~255 无符号整型，取值：</p><blockquote><p>Issuer Critical Flag：0<br>1~7 为保留标记</p></blockquote><p><code>&lt;tag&gt;</code> 定义为 US-ASCII 和 0~9 ，取值：</p><blockquote><p>CA 授权任何类型的域名证书（ Authorization Entry by Domain ） : issue<br>CA 授权通配符域名证书（ Authorization Entry by Wildcard Domain ） : issuewild<br>指定 CA 可报告策略违规（ Report incident by IODEF report ） : iodef<br>auth 、 path 和 policy 为保留标签</p></blockquote><p><code>&lt;value&gt;</code> 定义为八位字节序列的二进制编码字符串，一般填写格式为：</p><blockquote><p>[domain] [“;” * 参数]</p></blockquote><h3 id="CAA-资源记录示例"><a href="#CAA-资源记录示例" class="headerlink" title="CAA 资源记录示例"></a>CAA 资源记录示例</h3><p>当需要限制域名 <code>example.com</code> 及其子域名可由机构 <code>letsencrypt</code> 颁发不限类型的证书，同时可由 <code>Comodo</code> 颁发通配符证书，其他一律禁止，并且当违反配置规则时，发送通知邮件到 <code>example@example.com</code> 。</p><p>配置如下（为便于理解，二进制 Value 值已经过转码，下同）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">example.com.  CAA 0 issue &quot;letsencrypt.org&quot;</span><br><span class="line">example.com.  CAA 0 issuewild &quot;comodoca.com&quot;</span><br><span class="line">example.com.  CAA 0 iodef &quot;mailto:example@example.com&quot;</span><br></pre></td></tr></table></figure><p>如果子域名有单独列出证书颁发要求，例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">example.com.  CAA 0 issue &quot;letsencrypt.org&quot;</span><br><span class="line">alpha.example.com.  CAA 0 issue &quot;comodoca.com&quot;</span><br></pre></td></tr></table></figure><p>那么，因子域策略优先，所以只有 Comodo 可以为域名 <code>alpha.example.com.</code> 颁发证书。</p><h3 id="CAA-记录查询"><a href="#CAA-记录查询" class="headerlink" title="CAA 记录查询"></a>CAA 记录查询</h3><p>CAA 记录是一个相对较新的资源记录，目前很多工具并不支持。以 <code>dig</code> 为例，不能适用其标准语法。若需要查询 CAA 记录， <code>dig</code> 时需要直接指定 RR 类型（ type257 ）。</p><p>例如：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ dig google.com type257</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.3-P1 &lt;&lt;&gt;&gt; google.com type257</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 64266</span><br><span class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;google.com.            IN  TYPE257</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">google.com.     86399   IN  TYPE257 \# 19 0005697373756573796D616E7465632E636F6D</span><br><span class="line"></span><br><span class="line">;; Query time: 51 msec</span><br><span class="line">;; SERVER: 8.8.8.8#53(8.8.8.8)</span><br><span class="line">;; WHEN: Thu Dec 29 21:07:18 2016</span><br><span class="line">;; MSG SIZE  rcvd: 59</span><br></pre></td></tr></table></figure><p>该查询的输出是二进制编码记录，需要转码才能知道具体 CAA 策略。</p><h2 id="互联网证书环境前景剖析"><a href="#互联网证书环境前景剖析" class="headerlink" title="互联网证书环境前景剖析"></a>互联网证书环境前景剖析</h2><blockquote><p>以下所有言论仅代表个人观点。</p></blockquote><p>CAA 记录规范的提出已 4 年之久，但从未被普及；如今 CA|B Forum 关于强制 CAA 检查的提议亦结束 3 月有余，支持检查 CAA 的证书颁发机构依旧寥寥无几，支持配置 CAA 记录的 DNS 厂商更是少之又少。因而个人认为，这项规范的实施进程预计还是会挺艰难的。</p><p>不过从互联网安全发展来看，互联网受众越来越大，概念、架构越来越复杂，社会的重视程度一直在稳步提高。全面 https 也推行有一段时间了，强制 CAA 的普及大概只是时间问题。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;强制-CAA-检查的提议&quot;&gt;&lt;a href=&quot;#强制-CAA-检查的提议&quot; class=&quot;headerlink&quot; title=&quot;强制 CAA 检查的提议&quot;&gt;&lt;/a&gt;强制 CAA 检查的提议&lt;/h2&gt;&lt;p&gt;2017 年 3 月 7 日， CA|B Forum （一个全球证书颁发机构与浏览器的技术论坛）发起了一项关于对域名强制检查 CAA 的一项提议的投票，获得 187 票支持，投票有效，提议通过。&lt;/p&gt;
&lt;p&gt;提议通过后，将于 &lt;strong&gt;2017 年 9 月 8 日&lt;/strong&gt;根据 Mozilla 的 Gervase Markham 提出的检查 CAA 记录作为基准要求来实施。&lt;/p&gt;
&lt;p&gt;详情参见： &lt;a href=&quot;https://cabforum.org/2017/03/08/ballot-187-make-caa-checking-mandatory/&quot;&gt;Ballot 187 – Make CAA Checking Mandatory&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;什么是-CAA-记录？&quot;&gt;&lt;a href=&quot;#什么是-CAA-记录？&quot; class=&quot;headerlink&quot; title=&quot;什么是 CAA 记录？&quot;&gt;&lt;/a&gt;什么是 CAA 记录？&lt;/h2&gt;&lt;p&gt;CAA ，全称 Certificate Authority Authorization ，即证书颁发机构授权。它为了改善 PKI （ Public Key Infrastructure ：公钥基础设施）生态系统强度、减少证书意外错误发布的风险，通过 DNS 机制创建 CAA 资源记录，从而限定了特定域名颁发的证书和 CA （证书颁发机构）之间的联系。从此，再也不能是任意 CA 都可以为任意域名颁发证书了。&lt;/p&gt;</summary>
    
    
    
    <category term="知识探索" scheme="https://ephen.me/categories/knowledge/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="https" scheme="https://ephen.me/tags/https/"/>
    
    <category term="SSL" scheme="https://ephen.me/tags/SSL/"/>
    
    <category term="CAA" scheme="https://ephen.me/tags/CAA/"/>
    
  </entry>
  
  <entry>
    <title>给网站添加备案号展示</title>
    <link href="https://ephen.me/2017/beian/"/>
    <id>https://ephen.me/2017/beian/</id>
    <published>2017-02-21T16:00:00.000Z</published>
    <updated>2022-02-22T06:00:47.801Z</updated>
    
    <content type="html"><![CDATA[<h2 id="折腾原因"><a href="#折腾原因" class="headerlink" title="折腾原因"></a>折腾原因</h2><p>由于在公司折腾 <code>CloudXNS</code> 和<code>牛盾</code>，有个备案比较好开展工作。正好上次公司 CDN 网监来查，要求我把备案展示出来。想想这事情也该办了，搞起……</p><p>唔，还是提一嘴，姐无任何前端知识储备，大牛路过请点右上红叉关闭。</p><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><ol><li>备案号放至左侧边栏下方，链接到工信部网站；</li><li>备案号可进入主题 <code>_config.yml</code> 中配置修改；</li><li>文章页显示目录时不做展示；</li><li>放弃适配移动端。</li></ol><span id="more"></span><h2 id="折腾过程"><a href="#折腾过程" class="headerlink" title="折腾过程"></a>折腾过程</h2><h3 id="添加备案号并写入配置文件"><a href="#添加备案号并写入配置文件" class="headerlink" title="添加备案号并写入配置文件"></a>添加备案号并写入配置文件</h3><p>这部分比我想象中简单多了。照配置文件的 <code>AboutMe</code> 抄一抄居然就完成了。</p><p><code>left-col.ejs</code> 文件中添加以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">if</span> (theme.<span class="property">beian</span>)&#123; %&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;beian&quot;</span> <span class="attr">href</span>=<span class="string">&quot;http://www.miitbeian.gov.cn/state/outPortal/loginPortal.action&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>&lt;%=theme.beian%&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">&lt;%&#125;%&gt;</span><br></pre></td></tr></table></figure><p><code>_config.yml</code> 中添加：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 是否展示备案号</span></span><br><span class="line"><span class="comment">### beian: false# 不开启</span></span><br><span class="line"><span class="attr">beian:</span> <span class="string">鄂ICP备15003996号</span></span><br></pre></td></tr></table></figure><p>功能测试通过！</p><h3 id="备案号模块样式"><a href="#备案号模块样式" class="headerlink" title="备案号模块样式"></a>备案号模块样式</h3><p>样式主体是照抄的博客说明模块，以下是样式代码，续写到 <code>main.styl</code> 文件中的 <code>#header</code> 部分：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.beian</span>&#123;</span><br><span class="line"><span class="attribute">position</span>: relative;</span><br><span class="line"><span class="attribute">bottom</span>: <span class="number">15px</span>;</span><br><span class="line"><span class="attribute">font-weight</span>: <span class="number">300</span>;</span><br><span class="line"><span class="attribute">cursor</span>: pointer;</span><br><span class="line"><span class="attribute">text-transform</span>: uppercase;</span><br><span class="line"><span class="attribute">float</span>:none;</span><br><span class="line"><span class="attribute">text-align</span>: center;</span><br><span class="line"><span class="attribute">display</span>: -webkit-box;</span><br><span class="line">-webkit-box-orient: horizontal;</span><br><span class="line">-webkit-box-pack: center;</span><br><span class="line">-webkit-box-align: center;</span><br><span class="line"><span class="selector-tag">li</span>&#123;</span><br><span class="line"><span class="attribute">cursor</span>: default;</span><br><span class="line"><span class="selector-tag">a</span>&#123;</span><br><span class="line"><span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line"><span class="attribute">min-width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>bottom</code> 表示在页面底端保留的高度，配合 <code>position: relative;</code> 以保持在页面底端。</p><h3 id="显示目录时隐藏备案号"><a href="#显示目录时隐藏备案号" class="headerlink" title="显示目录时隐藏备案号"></a>显示目录时隐藏备案号</h3><p>本来不想做这个的，后来发现目录在时摆不好这个位置，同时如果目录过长过多会影响页面的美观，因此还是隐藏比较好。</p><p>目录是否显示的原本样式是在 <code>toc.ejs</code> 里面添加的 <code>&lt;style&gt;&lt;/style&gt;</code> 标签，在标签中添加：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#header</span> <span class="selector-class">.beian</span> &#123;</span><br><span class="line"><span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>就可以了。</p><h3 id="点击“显示目录”和“隐藏目录”时切换动画"><a href="#点击“显示目录”和“隐藏目录”时切换动画" class="headerlink" title="点击“显示目录”和“隐藏目录”时切换动画"></a>点击“显示目录”和“隐藏目录”时切换动画</h3><p>侧边栏目录初始状态动画展现在 <code>pc.js</code> 文件中，把 <code>.beian</code> 元素加进去：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> miniArchives = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $(<span class="string">&quot;.post-list&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;toc-article&quot;</span>);</span><br><span class="line">        $(<span class="string">&quot;#post-nav-button &gt; a:nth-child(2)&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            $(<span class="string">&quot;#post-nav-button .fa-bars,#post-nav-button .fa-times&quot;</span>).<span class="title function_">toggle</span>();</span><br><span class="line">            $(<span class="string">&quot;.post-list&quot;</span>).<span class="title function_">toggle</span>(<span class="number">300</span>);</span><br><span class="line">            <span class="keyword">if</span> ($(<span class="string">&quot;.toc&quot;</span>).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                $(<span class="string">&quot;#toc, #tocButton&quot;</span>).<span class="title function_">toggle</span>(<span class="number">200</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ($(<span class="string">&quot;.switch-area&quot;</span>).<span class="title function_">is</span>(<span class="string">&quot;:visible&quot;</span>)) &#123;</span><br><span class="line">                        $(<span class="string">&quot;#toc, .switch-btn, .switch-area, .beian&quot;</span>).<span class="title function_">toggle</span>();</span><br><span class="line">                        $(<span class="string">&quot;#tocButton&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;value&quot;</span>, yiliaConfig.<span class="property">toc</span>[<span class="number">0</span>]);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                $(<span class="string">&quot;.switch-btn, .switch-area, .beian&quot;</span>).<span class="title function_">fadeToggle</span>(<span class="number">300</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure><p>然后 <code>toc.js</code> 文件中有原本就有其他元素的切换动画，同样加个 <code>.beian</code> 即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#tocButton&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($(<span class="string">&quot;#toc&quot;</span>).<span class="title function_">is</span>(<span class="string">&quot;:hidden&quot;</span>)) &#123;</span><br><span class="line">        $(<span class="string">&quot;#tocButton&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;value&quot;</span>, valueHide);</span><br><span class="line">        $(<span class="string">&quot;#toc&quot;</span>).<span class="title function_">slideDown</span>(<span class="number">320</span>);</span><br><span class="line">        $(<span class="string">&quot;.switch-btn, .switch-area, .beian&quot;</span>).<span class="title function_">fadeOut</span>(<span class="number">300</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        $(<span class="string">&quot;#tocButton&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;value&quot;</span>, valueShow);</span><br><span class="line">        $(<span class="string">&quot;#toc&quot;</span>).<span class="title function_">slideUp</span>(<span class="number">350</span>);</span><br><span class="line">        $(<span class="string">&quot;.switch-btn, .switch-area, .beian&quot;</span>).<span class="title function_">fadeIn</span>(<span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="测试成功"><a href="#测试成功" class="headerlink" title="测试成功"></a>测试成功</h3><p>测试时chrome调试外还特地拿移动设备也试了下，并没有备案号，符合预期。</p><p>简单分析看了下，发现移动端的功能基本集中于 <code>mobile.js</code> 文件中，这个文件我并没有添加备案的相关信息。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>蛮早就想搞这个备案号展示的，可是因为害怕搞不定拖了两三个月，可真正做起来不到半天就搞完了。所以，哪有那么难？</p><p>总的来说，只要有想法，瞎抄都能抄到答案，差别只在于愿不愿意去做。</p><p>很多其他事情大概也是一样的：<strong>没做的时候以为是大山，做了才发现很简单。</strong></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;折腾原因&quot;&gt;&lt;a href=&quot;#折腾原因&quot; class=&quot;headerlink&quot; title=&quot;折腾原因&quot;&gt;&lt;/a&gt;折腾原因&lt;/h2&gt;&lt;p&gt;由于在公司折腾 &lt;code&gt;CloudXNS&lt;/code&gt; 和&lt;code&gt;牛盾&lt;/code&gt;，有个备案比较好开展工作。正好上次公司 CDN 网监来查，要求我把备案展示出来。想想这事情也该办了，搞起……&lt;/p&gt;
&lt;p&gt;唔，还是提一嘴，姐无任何前端知识储备，大牛路过请点右上红叉关闭。&lt;/p&gt;
&lt;h2 id=&quot;目标&quot;&gt;&lt;a href=&quot;#目标&quot; class=&quot;headerlink&quot; title=&quot;目标&quot;&gt;&lt;/a&gt;目标&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;备案号放至左侧边栏下方，链接到工信部网站；&lt;/li&gt;
&lt;li&gt;备案号可进入主题 &lt;code&gt;_config.yml&lt;/code&gt; 中配置修改；&lt;/li&gt;
&lt;li&gt;文章页显示目录时不做展示；&lt;/li&gt;
&lt;li&gt;放弃适配移动端。&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="博客折腾" scheme="https://ephen.me/categories/MyBlog/"/>
    
    
    <category term="hexo" scheme="https://ephen.me/tags/hexo/"/>
    
    <category term="备案" scheme="https://ephen.me/tags/beian/"/>
    
  </entry>
  
  <entry>
    <title>几乎花了一个下午的时间参观了风河博客</title>
    <link href="https://ephen.me/2016/fenghe-blog/"/>
    <id>https://ephen.me/2016/fenghe-blog/</id>
    <published>2016-12-29T16:00:00.000Z</published>
    <updated>2022-02-22T06:01:23.093Z</updated>
    
    <content type="html"><![CDATA[<p>2015 年 CloudXNS “重出江湖”的时候，我们做了个让用户写体验文章的活动，风河博客的一篇《<a href="http://blog.dnsbed.com/?p=1497">谈谈 CloudXNS </a>》吸引了我的眼球。</p><span id="more"></span><p>和其他人通篇描述智能 DNS 功能不同，这篇文章着重分析了底层 NS 服务的问题，并提了一些建议。于是我很感兴趣，翻看起这个博客来。</p><p>也许我并不是一个专业研究 DNS 的人，但是我却挺乐意学习这样的内容以丰富自己的工作。翻看风河博客发现，该主人也是做 DNS 的，并且对 NS 的研究还是蛮多的。所以对 CloudXNS 来讲，他们也是竞争对手，不过那又有什么关系呢？</p><p>博客内容很丰富，我看了很久，也学到了不少东西。很赞哦！</p><p>Mark几篇不错的内容（希望作者不会删，我偶尔还能再去看看）：</p><ol><li><a href="https://blog.dnsbed.com/?p=129">为什么 com 和 net 使用一组相同的名字服务器</a></li><li><a href="https://blog.dnsbed.com/?p=101">记一次 DNS 故障：更新 NS 服务器要随之更新 Glue</a></li><li><a href="https://blog.dnsbed.com/?p=91">为什么名字服务器必须注册？</a></li><li><a href="https://blog.dnsbed.com/?p=479">尽量少用泛域名</a></li><li><a href="https://blog.dnsbed.com/?p=1820">顶级域名启用泛记录的危害性</a></li><li><a href="https://blog.dnsbed.com/?p=442">一个域名使用多家 DNS</a></li><li><a href="https://blog.dnsbed.com/?p=1922"> DNS branding 设置示例</a></li></ol>]]></content>
    
    
    <summary type="html">&lt;p&gt;2015 年 CloudXNS “重出江湖”的时候，我们做了个让用户写体验文章的活动，风河博客的一篇《&lt;a href=&quot;http://blog.dnsbed.com/?p=1497&quot;&gt;谈谈 CloudXNS &lt;/a&gt;》吸引了我的眼球。&lt;/p&gt;</summary>
    
    
    
    <category term="知识探索" scheme="https://ephen.me/categories/knowledge/"/>
    
    <category term="心情驿站" scheme="https://ephen.me/categories/emo/"/>
    
    
    <category term="DNS" scheme="https://ephen.me/tags/DNS/"/>
    
    <category term="泛域名" scheme="https://ephen.me/tags/generic-domain/"/>
    
  </entry>
  
</feed>
